<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/db-course/livereload.js?mindelay=10&amp;v=2&amp;port=53502&amp;path=db-course/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.143.1">
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>Failures-Rollbacks :: Databases</title>

    
    <link href="../../css/nucleus.css?1742980635" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1742980635" rel="stylesheet">
    <link href="../../css/hybrid.css?1742980635" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1742980635" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1742980635" rel="stylesheet">
    <link href="../../css/auto-complete.css?1742980635" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1742980635" rel="stylesheet">
    <link href="../../css/theme.css?1742980635" rel="stylesheet">
    <link href="../../css/autonumbering.css?1742980635" rel="stylesheet">
    <link href="../../css/devselector.css?1742980635" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1742980635" rel="stylesheet">
    <link href="../../css/theme-kul.css?1742980635" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1742980635"></script>
    <script src="../../js/devselector.js?1742980635"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../../transacties/failures-rollbacks/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1742980635"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1742980635"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/localhost:53502\/db-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1742980635"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/sql/" title="RDBMS" class="dd-item
        
        
        
        ">
      <a href="../../sql/">
          RDBMS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-basics/" title="Database Basics" class="dd-item ">
        <a href="../../sql/rdbms-basics/">
        Database Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-components/" title="Database Componenten" class="dd-item ">
        <a href="../../sql/rdbms-components/">
        Database Componenten
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-acid/" title="ACID" class="dd-item ">
        <a href="../../sql/rdbms-acid/">
        ACID
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/sql-ddl-dml/" title="SQL DDL &amp; DML" class="dd-item
        
        
        
        ">
      <a href="../../sql-ddl-dml/">
          SQL DDL &amp; DML
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/ddl/" title="DDL" class="dd-item ">
        <a href="../../sql-ddl-dml/ddl/">
        DDL
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/dml/" title="DML" class="dd-item ">
        <a href="../../sql-ddl-dml/dml/">
        DML
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/transacties/" title="RDBMS Transacties" class="dd-item
        parent
        
        
        ">
      <a href="../../transacties/">
          RDBMS Transacties
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/transacties/acid/" title="ACID" class="dd-item ">
        <a href="../../transacties/acid/">
        ACID
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/basics/" title="Transaction Mgmt. Basics" class="dd-item ">
        <a href="../../transacties/basics/">
        Transaction Mgmt. Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/concurrency-control/" title="Concurrency Control" class="dd-item ">
        <a href="../../transacties/concurrency-control/">
        Concurrency Control
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/failures-rollbacks/" title="Failures-Rollbacks" class="dd-item active">
        <a href="../../transacties/failures-rollbacks/">
        Failures-Rollbacks
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/apis/" title="Database APIs" class="dd-item
        
        
        
        ">
      <a href="../../apis/">
          Database APIs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/apis/basics/" title="API Basics" class="dd-item ">
        <a href="../../apis/basics/">
        API Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jdbc/" title="JDBC - Java Database Connectivity" class="dd-item ">
        <a href="../../apis/jdbc/">
        JDBC - Java Database Connectivity
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jdbi/" title="JDBI - Java DataBase Interface v3" class="dd-item ">
        <a href="../../apis/jdbi/">
        JDBI - Java DataBase Interface v3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://studiegidswww.uhasselt.be/opleidingsonderdeel.aspx?a=2025&amp;i=4290"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://toledo.kuleuven.be/portal/"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/kuleuven-diepenbeek/db-course/"><i class='fab fa-github'></i> Course Git Repository</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Index</a> > <a href='../../transacties/'>RDBMS Transacties</a> > Failures-Rollbacks
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
  <div class="wrapper toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#system-failure-simulatie">System failure simulatie</a>
      <ul>
        <li><a href="#in-sqlite-met-db-browser">In SQLite met DB Browser</a></li>
        <li><a href="#in-sqlite-met-javajdbc">In SQLite met Java/JDBC</a></li>
      </ul>
    </li>
    <li><a href="#denkvragen">Denkvragen</a></li>
  </ul>
</nav></div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Failures-Rollbacks
            </h1>
          

        

        





<article class='content'>
<p>Voorbereidende <code>CREATE</code> statements (Dit is SQLite syntax!) Zie <a href="https://sqlite.org/autoinc.html">SQLite manual</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#00a8c8">DROP</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#00a8c8">IF</span> <span style="color:#00a8c8">EXISTS</span> <span style="color:#111">student</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#111">student</span><span style="color:#111">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">studnr</span> <span style="color:#111">INT</span> <span style="color:#00a8c8">NOT</span> <span style="color:#00a8c8">NULL</span> <span style="color:#00a8c8">PRIMARY</span> <span style="color:#00a8c8">KEY</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">naam</span> <span style="color:#111">VARCHAR</span><span style="color:#111">(</span><span style="color:#ae81ff">200</span><span style="color:#111">)</span> <span style="color:#00a8c8">NOT</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">voornaam</span> <span style="color:#111">VARCHAR</span><span style="color:#111">(</span><span style="color:#ae81ff">200</span><span style="color:#111">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">goedbezig</span> <span style="color:#111">BOOL</span>
</span></span><span style="display:flex;"><span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">DROP</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#00a8c8">IF</span> <span style="color:#00a8c8">EXISTS</span> <span style="color:#111">log</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#111">log</span><span style="color:#111">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">id</span> <span style="color:#111">INTEGER</span> <span style="color:#00a8c8">NOT</span> <span style="color:#00a8c8">NULL</span> <span style="color:#00a8c8">PRIMARY</span> <span style="color:#00a8c8">KEY</span> <span style="color:#111">AUTOINCREMENT</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">date</span> <span style="color:#111">DATETIME</span> <span style="color:#00a8c8">DEFAULT</span> <span style="color:#00a8c8">CURRENT_TIMESTAMP</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">foreign_id</span> <span style="color:#111">INT</span> <span style="color:#00a8c8">NOT</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">msg</span> <span style="color:#111">TEXT</span>
</span></span><span style="display:flex;"><span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">student</span><span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedbezig</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span> <span style="color:#111">(</span><span style="color:#ae81ff">123</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Trekhaak&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Jaak&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">student</span><span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedbezig</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span> <span style="color:#111">(</span><span style="color:#ae81ff">456</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Peeters&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Jos&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">student</span><span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedbezig</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span> <span style="color:#111">(</span><span style="color:#ae81ff">890</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Dongmans&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Ding&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
</span></span></code></pre></div><h2 id="system-failure-simulatie">System failure simulatie</h2>
<h3 id="in-sqlite-met-db-browser">In SQLite met DB Browser</h3>
<p>Gegeven een aantal SQL statements, waarvan niet alle statements kloppen, maar die wel allemaal bij elkaar horen als één <strong>atomaire transactie</strong>. Dat betekent dat als er één van die statements misloopt, de rest teruggedraait zou moeten worden. Het spreekt voor zich dat zonder speciale handelingen, zoals het beheren van transacties, dit niet gebeurt. Een eenvoudig voorbeeld demonstreert dit.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#00a8c8">UPDATE</span> <span style="color:#111">student</span> <span style="color:#00a8c8">SET</span> <span style="color:#111">voornaam</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;Jaqueline&#39;</span> <span style="color:#00a8c8">WHERE</span> <span style="color:#111">studnr</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">123</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">oeitiskapot</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">log</span><span style="color:#111">(</span><span style="color:#111">foreign_id</span><span style="color:#111">,</span> <span style="color:#111">msg</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span> <span style="color:#111">(</span><span style="color:#ae81ff">123</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Voornaam vergissing&#39;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">student</span><span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedbezig</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span> <span style="color:#111">(</span><span style="color:#ae81ff">445</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Klakmans&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Jef&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">log</span><span style="color:#111">(</span><span style="color:#111">foreign_id</span><span style="color:#111">,</span> <span style="color:#111">msg</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span> <span style="color:#111">(</span><span style="color:#ae81ff">445</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Nieuwe student registratie&#39;</span><span style="color:#111">);</span>
</span></span></code></pre></div><p>Plak dit in de &ldquo;Execute SQL&rdquo; tab van de SQLite DB Browser. Het resultaat is een foutboodschap:</p>
<pre tabindex="0"><code>near &#34;;&#34;: syntax error: 
INSERT INTO oeitiskapot;
</code></pre><p><strong>Maar</strong>: het eerste <code>UPDATE</code> statement, voor de foute regel, is wel uitgevoerd:</p>
<p><figure>
	<a href="../../img/sqlite-fout.jpg" data-featherlight="image">
		<img src="../../img/sqlite-fout.jpg"  >
	</a>
	
</figure>
</p>
<h4 id="oefeningen">Oefeningen</h4>
<ol>
<li>Probeer bovenstaande voorbeeld zelf uit in de SQLite DB Browser. Als je jezelf ervan verzekerd hebt dat inderdaad het eerste <code>UPDATE</code> statement wordt uitgevoerd, terwijl wij dat in één ACID blok willen, ga dan over naar de volgende oefening.</li>
<li>In SQLite is het starten van een transactie erg eenvoudig: zie <a href="https://www.tutorialspoint.com/sqlite/sqlite_transactions.htm">SQLite transaction tutorials</a> van tutorialspoint.com. <code>BEGIN;</code> en <code>COMMIT;</code> zijn voldoende. Probeer dit uit in bovenstaande voorbeeld om er voor te zorgen dat de voornaam van Jaak niet wordt gewijzigd. Om met een &ldquo;clean slate&rdquo; te herbeginnen kan je gewoon de voorbereidende SQL code copy/pasten en opnieuw uitvoeren. Merk op dat dit nog steeds het ongewenst effect heeft dat de student zijn/haar naam wordt gewijzigd. We moeten expliciet zelf <code>ROLLBACK;</code> aanroepen.</li>
<li>Probeer een nieuwe student toe te voegen: eentje met studentennummer, en eentje zonder. Dat tweede kan in principe niet door de <code>NOT NULL</code> constraint. Wrap beide statements in een transactie.</li>
</ol>
<p><strong>Let Op</strong>: Het zou kunnen dat SQLite de volgende fout geeft: <code>cannot start a transaction within a transaction: BEGIN;</code>. Queries die geplakt worden in het &ldquo;execute SQL&rdquo; scherm worden meestal (onzichtbaar, achter de schermen) gewrapped in transacties. Stop de huidige transactie door <code>COMMIT;</code> uit te voeren met de knop &ldquo;execute single SQL line&rdquo;.</p>
<p><strong>Let Op</strong>: Het zou kunnen dat <code>BEGIN TRANSACTION;</code> de transactie niet goed encapsuleert, maar simpelweg <code>BEGIN;</code> wel. Het <code>TRANSACTION</code> keyword is optioneel <a href="https://www.sqlite.org/lang_transaction.html">volgens de SQLite docs</a> en lijkt, afhankelijk van de geïnstalleerde SQLite versie, ander gedrag te vertonen.</p>
<h3 id="in-sqlite-met-javajdbc">In SQLite met Java/JDBC</h3>
<p>SQLite/JDBC uitleg: zie APIs - JDBC.</p>
<p>Gebruik nu  <code>connection.setAutoCommit(false)</code>. Deze regel is nodig omdat in JDBC standaard elke SQL statement aanschouwd wordt als een onafhankelijke transactie, die automatisch wordt gecommit:</p>
<blockquote>
<p>When a connection is created, it is in auto-commit mode. This means that each individual SQL statement is treated as a transaction and is automatically committed right after it is executed. (To be more precise, the default is for a SQL statement to be committed when it is completed, not when it is executed. A statement is completed when all of its result sets and update counts have been retrieved. In almost all cases, however, a statement is completed, and therefore committed, right after it is executed.)</p></blockquote>
<p>Je kan nu manueel committen met <code>connection.commit();</code>.</p>
<p>Zie JDBC Basics in Oracle docs: <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/transactions.html">https://docs.oracle.com/javase/tutorial/jdbc/basics/transactions.html</a></p>
<h4 id="oefeningen-1">Oefeningen</h4>
<ol>
<li>
<p>Maak een nieuw Gradle project aan en connecteer naar je SQLite database. Merk op dat, bij connectionstring <code>&quot;jdbc:sqlite:sample.db&quot;</code>, automatisch een lege <code>.db</code> file wordt aangemaakt indien de database niet bestaat. Probeer met behulp van <code>executeUpdate()</code> en <code>executeQuery()</code> bovenstaande system failure te veroorzaken. Je kan de &ldquo;foute SQL&rdquo; (met &ldquo;oeitiskapot&rdquo;) gewoon in een string in java copy/pasten. <code>executeUpdate()</code> kan verschillende statements tegelijkertijd verwerken. Verifieer dat de naam foutief toch wordt gewijzigd met een <code>SELECT()</code> nadat je de fout hebt opgevangen in een <code>try { }</code> block.

<div class="notices warning" ><p>Je moet nu dan ook wel de juiste aanpassingen doen om met een SQLite database te connecteren zie <a href="../../apis/jdbc-jdbi#jdbc-met-sqlite">hier</a></p>
</div>
</p>
</li>
<li>
<p>Het probleem is op te lossen met één welgeplaatste regel: <code>connection.rollback()</code>. De vraag is echter: waar plaatsen we die? En ja, <code>rollback()</code> throwt ook de checked <code>SQLException</code>&hellip; Verifieer of je oplossing werkt door de naam na de rollback terug op te halen en te vergelijken met de juiste waarde: &ldquo;Jaak&rdquo;.</p>
</li>
</ol>

<div class="notices note" ><p>Aangezien de API als zeer slim geworden is zal er zelfs een rollback plaatsvinden bij het opkomen van een SQLException zelfs als je zelf die rollback niet specifiek oproept in de <code>catch</code>-clausule. Daarom gaan we deze oefening samen even als demo bekijken.</p>
</div>

<p>De <code>DROP TABLE IF EXISTS</code> statements kan je in je project in een aparte SQL file bewaren en als een String inlezen, om in één keer te laten uitvoeren na het openen van de connectie:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">private</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">initTables</span><span style="color:#111">()</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">Exception</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">URI</span> <span style="color:#111">path</span> <span style="color:#f92672">=</span> <span style="color:#111">Objects</span><span style="color:#111">.</span><span style="color:#75af00">requireNonNull</span><span style="color:#111">(</span><span style="color:#111">App</span><span style="color:#111">.</span><span style="color:#75af00">class</span><span style="color:#111">.</span><span style="color:#75af00">getClassLoader</span><span style="color:#111">().</span><span style="color:#75af00">getResource</span><span style="color:#111">(</span><span style="color:#d88200">&#34;create_db.sql&#34;</span><span style="color:#111">)).</span><span style="color:#75af00">toURI</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">create_db_sql</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">String</span><span style="color:#111">(</span><span style="color:#111">Files</span><span style="color:#111">.</span><span style="color:#75af00">readAllBytes</span><span style="color:#111">(</span><span style="color:#111">Paths</span><span style="color:#111">.</span><span style="color:#75af00">get</span><span style="color:#111">(</span><span style="color:#111">path</span><span style="color:#111">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#111">create_db_sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#111">create_db_sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><p>De verwachte fout (met de ongeldige SQL regel) die SQLite doorgeeft aan Java genereert de volgende stacktrace:</p>
<pre tabindex="0"><code>org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near &#34;;&#34;: syntax error)
    at org.sqlite.core.DB.newSQLException(DB.java:1010)
    at org.sqlite.core.DB.newSQLException(DB.java:1022)
    at org.sqlite.core.DB.throwex(DB.java:987)
    at org.sqlite.core.NativeDB._exec_utf8(Native Method)
    at org.sqlite.core.NativeDB._exec(NativeDB.java:94)
    at org.sqlite.jdbc3.JDBC3Statement.executeUpdate(JDBC3Statement.java:109)
    at SQLiteTransactionTest.doStuff(SQLiteTransactionTest.java:54)
    at SQLiteMain.main(SQLiteMain.java:7)
</code></pre><h2 id="denkvragen">Denkvragen</h2>
<ul>
<li>De SQLite website beschrijft in detail hoe ze omgaan met &ldquo;atomic commits&rdquo; om aan de ACID regels te voldoen. Lees dit na op <a href="https://sqlite.org/atomiccommit.html">https://sqlite.org/atomiccommit.html</a> Op welke manier gebruiken zij een rollback journal? Hoe is dat gelinkt aan de logfile van 14.2.3 op p.435?</li>
</ul>

</article>

<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../transacties/concurrency-control/" title="Concurrency Control"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../apis/" title="Database APIs" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1742980635"></script>
    <script src="../../js/perfect-scrollbar.min.js?1742980635"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1742980635"></script>
    <script src="../../js/jquery.sticky.js?1742980635"></script>
    <script src="../../js/featherlight.min.js?1742980635"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1742980635"></script>
    <script src="../../js/learn.js?1742980635"></script>
    <script src="../../js/hugo-learn.js?1742980635"></script>
    <script src="../../js/mermaid.min.js?1742980635"></script>
    <script>
    window.MathJax = {
      chtml: {
        scale: 1,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

