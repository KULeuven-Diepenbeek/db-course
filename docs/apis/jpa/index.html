<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/db-course/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=db-course/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.143.1">
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>JPA en Hibernate :: Databases</title>

    
    <link href="../../css/nucleus.css?1747132608" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1747132608" rel="stylesheet">
    <link href="../../css/hybrid.css?1747132608" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1747132608" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1747132608" rel="stylesheet">
    <link href="../../css/auto-complete.css?1747132608" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1747132608" rel="stylesheet">
    <link href="../../css/theme.css?1747132608" rel="stylesheet">
    <link href="../../css/autonumbering.css?1747132608" rel="stylesheet">
    <link href="../../css/devselector.css?1747132608" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1747132608" rel="stylesheet">
    <link href="../../css/theme-kul.css?1747132608" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1747132608"></script>
    <script src="../../js/devselector.js?1747132608"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../../apis/jpa/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1747132608"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1747132608"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/localhost:1313\/db-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1747132608"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/sql/" title="RDBMS" class="dd-item
        
        
        
        ">
      <a href="../../sql/">
          RDBMS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-basics/" title="Database Basics" class="dd-item ">
        <a href="../../sql/rdbms-basics/">
        Database Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-components/" title="Database Componenten" class="dd-item ">
        <a href="../../sql/rdbms-components/">
        Database Componenten
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-acid/" title="ACID" class="dd-item ">
        <a href="../../sql/rdbms-acid/">
        ACID
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/sql-ddl-dml/" title="SQL DDL &amp; DML" class="dd-item
        
        
        
        ">
      <a href="../../sql-ddl-dml/">
          SQL DDL &amp; DML
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/ddl/" title="DDL" class="dd-item ">
        <a href="../../sql-ddl-dml/ddl/">
        DDL
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/dml/" title="DML" class="dd-item ">
        <a href="../../sql-ddl-dml/dml/">
        DML
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/transacties/" title="RDBMS Transacties" class="dd-item
        
        
        
        ">
      <a href="../../transacties/">
          RDBMS Transacties
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/transacties/acid/" title="ACID" class="dd-item ">
        <a href="../../transacties/acid/">
        ACID
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/basics/" title="Transaction Mgmt. Basics" class="dd-item ">
        <a href="../../transacties/basics/">
        Transaction Mgmt. Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/concurrency-control/" title="Concurrency Control" class="dd-item ">
        <a href="../../transacties/concurrency-control/">
        Concurrency Control
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/failures-rollbacks/" title="Failures-Rollbacks" class="dd-item ">
        <a href="../../transacties/failures-rollbacks/">
        Failures-Rollbacks
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/apis/" title="Database APIs" class="dd-item
        parent
        
        
        ">
      <a href="../../apis/">
          Database APIs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/apis/basics/" title="API Basics" class="dd-item ">
        <a href="../../apis/basics/">
        API Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jdbc/" title="JDBC" class="dd-item ">
        <a href="../../apis/jdbc/">
        JDBC
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jdbi/" title="JDBI" class="dd-item ">
        <a href="../../apis/jdbi/">
        JDBI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jpa/" title="JPA en Hibernate" class="dd-item active">
        <a href="../../apis/jpa/">
        JPA en Hibernate
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/repository_interface/" title="Interface" class="dd-item ">
        <a href="../../apis/repository_interface/">
        Interface
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/opdracht/" title="VERPLICHTE opdracht" class="dd-item ">
        <a href="../../apis/opdracht/">
        VERPLICHTE opdracht
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/nosql/" title="NoSQL" class="dd-item
        
        
        
        ">
      <a href="../../nosql/">
          NoSQL
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/nosql/basics/" title="NoSQL Basics" class="dd-item ">
        <a href="../../nosql/basics/">
        NoSQL Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/documentstores/" title="Document Stores met MongoDB" class="dd-item ">
        <a href="../../nosql/documentstores/">
        Document Stores met MongoDB
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/opdracht/" title="VERPLICHTE opdracht" class="dd-item ">
        <a href="../../nosql/opdracht/">
        VERPLICHTE opdracht
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/4oef3/" title="" class="dd-item ">
        <a href="../../nosql/4oef3/">
        
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/timeseries/" title="Timeseries database" class="dd-item
        
        
        
        ">
      <a href="../../timeseries/">
          Timeseries database
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/timeseries/timeseriesdb/" title="Timeseries database met InfluxDb" class="dd-item ">
        <a href="../../timeseries/timeseriesdb/">
        Timeseries database met InfluxDb
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/timeseries/opdracht/" title="VERPLICHTE opdracht" class="dd-item ">
        <a href="../../timeseries/opdracht/">
        VERPLICHTE opdracht
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/xml/" title="XML Data Storage" class="dd-item
        
        
        
        ">
      <a href="../../xml/">
          XML Data Storage
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/xml/basics/" title="XML Basics" class="dd-item ">
        <a href="../../xml/basics/">
        XML Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/xml/xsd/" title="XSD" class="dd-item ">
        <a href="../../xml/xsd/">
        XSD
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/xml/xpath/" title="XPath" class="dd-item ">
        <a href="../../xml/xpath/">
        XPath
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bigdata/" title="Big Data &amp; Analytics" class="dd-item
        
        
        
        ">
      <a href="../../bigdata/">
          Big Data &amp; Analytics
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/bigdata/basics/" title="Big Data Basics" class="dd-item ">
        <a href="../../bigdata/basics/">
        Big Data Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata/datawarehousing/" title="Data Warehousing &amp; BI" class="dd-item ">
        <a href="../../bigdata/datawarehousing/">
        Data Warehousing &amp; BI
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/extra/" title="Extras" class="dd-item
        
        
        
        ">
      <a href="../../extra/">
          Extras
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/extra/kennen-kunnen/" title="Examen: Kennen en kunnen" class="dd-item ">
        <a href="../../extra/kennen-kunnen/">
        Examen: Kennen en kunnen
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://studiegidswww.uhasselt.be/opleidingsonderdeel.aspx?a=2025&amp;i=4290"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://toledo.kuleuven.be/portal/"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/kuleuven-diepenbeek/db-course/"><i class='fab fa-github'></i> Course Git Repository</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Index</a> > <a href='../../apis/'>Database APIs</a> > JPA en Hibernate
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
  <div class="wrapper toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#wat-is-jpa">Wat is JPA?</a>
      <ul>
        <li><a href="#maar-wat-is-de-jpa-api-nu-precies">Maar wat is de JPA API nu precies?</a></li>
      </ul>
    </li>
    <li><a href="#wat-is-hibernate-orm-object-relational-mapper">Wat is Hibernate ORM (Object Relational Mapper)?</a>
      <ul>
        <li><a href="#hibernatejpa-bootstrapping">Hibernate/JPA Bootstrapping</a></li>
        <li><a href="#hibernatejpa-peristencequerying">Hibernate/JPA Peristence/querying</a></li>
        <li><a href="#jdbc-met-sqlite-ideaal-voor-testing">Jdbc met SQLite: ideaal voor testing</a></li>
        <li><a href="#demo-jpa-met-relations">DEMO: JPA met relations</a></li>
      </ul>
    </li>
    <li><a href="#opdracht">OPDRACHT</a></li>
  </ul>
</nav></div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              JPA en Hibernate
            </h1>
          

        

        





<article class='content'>
<h2 id="wat-is-jpa">Wat is JPA?</h2>
<p>JPA of de <strong>Jakarta Persistence API</strong> <em>(vroeger de Java Persistence API genoemd)</em> is een deel van Java EE (Java <em>Enterprise Platform</em>), een set van specificaties die initieel de JDK SE 8 versie uitbreidden met &ldquo;enterprise&rdquo; features zoals distributed computing en web services. J2EE wordt vooral ingezet als het gaat over grote applicaties die bedrijven ontwikkelen voor andere bedrijven (zogenaamde &ldquo;B2B&rdquo;, Business 2 Business, of Enterprise Software Development).</p>

<div class="notices note" ><p>Ondertussen is J2EE omgevormd tot <a href="https://jakarta.ee">Jakarta EE</a>. Dat betekent ook dat JPA <a href="https://blogs.oracle.com/javamagazine/post/transition-from-java-ee-to-jakarta-ee">recent officieel werd vervangen</a> door de Jakarta Persistence API. Je zal merken dat de <code>javax.persistence</code> dependency die wij gebruiken niet meer wordt geupdate. Pas dus op met recente Stack Overflow links!</p>
</div>

<h3 id="maar-wat-is-de-jpa-api-nu-precies">Maar wat is de JPA API nu precies?</h3>
<p>De API, levend in de package <code>javax.persistence</code>, is een manier om relationele data voor te stellen in enterprise Java applicaties, door middel van Objecten. Het is dus een mapping tool die object/relationale (meta)data bewerkt en verwerkt. JPA heeft ook zijn eigen query language, JPQL, die het eenvoudiger moet maken om queries te schrijven <em>in Java code zelf</em> in plaats van in SQL, die vertaald worden naar SQL. <strong>Dit vereenvoudigt refactoring en vermindert mogelijke fouten in de SQL string die te laat naar boven komen (nu compiletime ipv runtime, aangezien Java statisch getypeerd is).</strong></p>
<p>JPA is niet meer dan een specificatie die de <strong>interfaces</strong> en <strong>annotaties</strong> voorziet. De implementatie, en de <strong>klasses</strong>, worden overgelaten aan <em>vendors</em>, waarvan voor JPA 2.2 <a href="https://en.wikipedia.org/wiki/Jakarta_Persistence">de volgende vendors</a> beschikbaar zijn:</p>
<ul>
<li>DataNucleus</li>
<li>EclipseLink</li>
<li><strong>Hibernate</strong></li>
<li>OpenJPA</li>
</ul>
<p>JPA 2.2 Gradle dependency: <code>implementation 'javax.persistence:javax.persistence-api:2.2'</code></p>
<h2 id="wat-is-hibernate-orm-object-relational-mapper">Wat is Hibernate ORM (Object Relational Mapper)?</h2>
<p>Volgens de <a href="http://hibernate.org/orm/">hibernate.org</a> website:</p>
<blockquote>
<p>Your relational data. Objectively.</p></blockquote>
<p>Kort door de bocht uitgelegd is het een manier om Java Klassen te annoteren, zodat objecten automatisch in een database kunnen opgeslagen, opgehaald, geupdated of gedeleted kunnen worden zonder zelf nog queries te moeten schrijven. Je blijft dus eigenlijk steeds in Java land werken en moet je na een initiële configuratie niets meer aantrekken van hoe de data in de database zit of opgehaald wordt. Voor degene die het vak Full Stack Web Development opnemen, is dit al een tweede ORM die ze tegenkomen. In PHP/Laravel hebben hebben we met de PHP ORM gewerkt.</p>
<p>Hibernate is dé populairste object-relational mapper in Java die de JPA standaard implementeert. Hibernate heeft zowel een eigen API als een JPA specificatie, en kan dus overal waar JPA nodig is ingeschakeld worden. Het wordt vaak in omgevingen gebruikt waar performantie belangrijk is, en waar enorm veel data en gebruikers data transfereren.</p>
<p><strong>Belangrijk startpunt:</strong> <a href="https://docs.jboss.org/hibernate/orm/5.4/quickstart/html_single/">Hibernate getting started guide</a> Ook Hibernate werkt met modules, zoals Jdbi3. We gebruiken <code>hibernate-core</code>; via Gradle: <code>compile group: 'org.hibernate', name: 'hibernate-core', version: '5.4.23.Final'</code></p>
<p>Het gebruik van Hibernate geeft meestal een aantal mogelijkheden:</p>
<ol>
<li>Gebruik de Native Hibernate API en <code>hbm.xml</code> mapping (Zie &ldquo;2. Tutorial Using Native Hibernate APIs and hbm.xml Mapping&rdquo;)</li>
<li>Gebruik de Native Hibernate API en annotaties (Zie &ldquo;3. Tutorial Using Native Hibernate APIs and Annotation Mappings&rdquo;)</li>
<li>Gebruik de JPA interface (Zie &ldquo;4. Tutorial Using the Java Persistence API (JPA)&rdquo;)</li>
</ol>
<p><strong>Waarvan wij #3 gaan hanteren!!!</strong></p>
<h3 id="hibernatejpa-bootstrapping">Hibernate/JPA Bootstrapping</h3>
<p>JPA bootstrappen kan - net zoals JDBC en JDBI - vrij eenvoudig met een statische klasse <code>Persistence</code> die een <code>sessionFactory</code> object aanmaakt. Elke <strong>session factory</strong> stelt een verbinding voor tussen de Java code en de Database zelf. Om te kunnen werken met objecten moet je vanuit de session factory de <strong>entity manager</strong> creëren. Vanaf dan kan er worden gewerkt met de database via de entity manager instantie.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">var</span> <span style="color:#111">sessionFactory</span> <span style="color:#f92672">=</span> <span style="color:#111">Persistence</span><span style="color:#111">.</span><span style="color:#75af00">createEntityManagerFactory</span><span style="color:#111">(</span><span style="color:#d88200">&#34;be.kuleuven.studenthibernate&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">var</span> <span style="color:#111">entityManager</span> <span style="color:#f92672">=</span> <span style="color:#111">sessionFactory</span><span style="color:#111">.</span><span style="color:#75af00">createEntityManager</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// do stuff with it!</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// entityManager.createQuery(&#34;SELECT s FROM Student s&#34;, Student.class);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// entityManager.getTransaction();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// CREATE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// entityManager.persist(student);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// READ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// entityManager.find(Student.class, studnr);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// UPDATE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// entityManager.merge(student);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// DELETE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// entityManager.remove(student);</span>
</span></span></code></pre></div><p><code>javax.persistence.Persistence</code> gaat op zoek naar een <code>persistence.xml</code> bestand in de map <code>src/main/resources/META-INF</code>. Die bevat alle connectiegegevens en instellingen. De <strong>persistence XML file</strong> is de <em>belangrijkste</em> file van je hele applicatie, waar caching strategie, driver management, table autocreation, &hellip; allemaal in wordt bepaald!</p>
<p>Een voorbeeld XML file voor onze Studenten demo&rsquo;s:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;persistence</span> <span style="color:#75af00">version=</span><span style="color:#d88200">&#34;2.1&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75af00">xmlns=</span><span style="color:#d88200">&#34;http://xmlns.jcp.org/xml/ns/persistence&#34;</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#75af00">xmlns:xsi=</span><span style="color:#d88200">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75af00">xsi:schemaLocation=</span><span style="color:#d88200">&#34;http://xmlns.jcp.org/xml/ns/persistence 
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                                 http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;persistence-unit</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;be.kuleuven.studenthibernate&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;description&gt;</span>Studenten JPA Test<span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;provider&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span style="color:#f92672">&lt;/provider&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- MySQL driver --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;javax.persistence.jdbc.driver&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Pas de URL, user en password aan naar jouw XAMPP configuratie --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;javax.persistence.jdbc.url&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;jdbc:mysql://localhost:3306/school&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;javax.persistence.jdbc.user&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;root&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;javax.persistence.jdbc.password&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Schema generatie: drop en create bij elke run --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- UNCOMMENT HIERONDER ALS JE MET import.sql WIL WERKEN --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- &lt;property name=&#34;javax.persistence.schema-generation.database.action&#34; value=&#34;drop-and-create&#34;/&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Hibernate specifieke properties --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.dialect&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;org.hibernate.dialect.MariaDBDialect&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.connection.autocommit&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.show_sql&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.flushMode&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;ALWAYS&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.cache.use_second_level_cache&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/persistence-unit&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/persistence&gt;</span>
</span></span></code></pre></div><p>Bevat onder andere de volgende belangrijke properties:</p>
<ul>
<li><code>javax.persistence</code> JDBC driver/url. Merk op dat achterliggend dus nog steeds JDBC wordt gebruikt! Dat betekent ook dat we de MYSQL dependency <code>'mysql:mysql-connector-java:5.1.6'</code> nog steeds nodig hebben.</li>
<li><code>schema-generation</code> properties: <code>drop-and-create</code> betekent dat tabellen die niet bestaan automatisch worden aangemaakt. Geen <code>CREATE TABLE</code> statements meer nodig, dus. <strong>Kan je ook weglaten</strong></li>
<li><code>hibernate.dialect</code>: voor vendor-specifieke queries te genereren moet Hibernate weten welke database wij hanteren. Dit staat los van de jdbc driver! Hiervoor gebruiken we het dialect van MYSQL <code>&quot;org.hibernate.dialect.MariaDBDialect&quot;</code>.</li>
<li>Flush modes, auto-commit instellingen, caching, e.a. Dit gaat ver buiten de scope van deze cursus.</li>
<li><code>show_sql</code> print de gegenereerde queries af in de console, handig om te zien hoe Hibernate intern werkt, en om te debuggen.</li>
</ul>
<p>Er ontbreekt hierboven nog een belangrijk gegeven: elke entity (domein object dat een tabel voorstelt in de code) moet met fully qualified name in een <code>&lt;class/&gt;</code> tag onder <code>&lt;persistence-unit/&gt;</code> worden toegevoegd. Anders herkent JPA het object niet, en heeft hij geen idee welke kolommen te mappen op welke properties. Die metadata zit namelijk in de entity klasse zelf. Je moet die klassen vlak boven de <code>&lt;properties&gt;</code>-tag toevoegen:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;provider&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span style="color:#f92672">&lt;/provider&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- HIER KLASSEN TOEVOEGEN --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;class&gt;</span>be.kuleuven.Student<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;class&gt;</span>be.kuleuven.Vak<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;class&gt;</span>be.kuleuven.Opleiding<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>           ...
</span></span></code></pre></div><p>Meer informatie: zie <a href="http://hibernate.org/orm/">hibernate.org documentatie</a> en <a href="https://thorben-janssen.com/jpa-persistence-xml/">A beginners guide to JPA persistence xml</a>.</p>
<h3 id="hibernatejpa-peristencequerying">Hibernate/JPA Peristence/querying</h3>
<p>Nu de verbinding tussen de DB en Hibernate/JPA tot stand werd gebracht, is het tijd om gebruik te maken van de kracht van de library.</p>
<p>Om kolommen te kunnen mappen op properties voorziet JPA een aantal <strong>annotaties</strong> als meta-data op het domeinobject zelf. Dat betekent dat DB beschrijving netjes bij het object waar het hoort wordt geplaatst. Bijvoorbeeld:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75af00">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#75af00">@Table</span><span style="color:#111">(</span><span style="color:#111">name</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;student&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">Student</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75af00">@Id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">int</span> <span style="color:#111">studnr</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75af00">@Column</span><span style="color:#111">(</span><span style="color:#111">name</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;voornaam&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a8c8">private</span> <span style="color:#111">String</span> <span style="color:#111">voornaam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75af00">@Column</span><span style="color:#111">(</span><span style="color:#111">name</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;naam&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a8c8">private</span> <span style="color:#111">String</span> <span style="color:#111">naam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75af00">@Column</span><span style="color:#111">(</span><span style="color:#111">name</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;goedbezig&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">boolean</span> <span style="color:#111">goedBezig</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><p>Het datatype kan ook worden ingesteld met <code>@Column</code> (merk op dat de kolomnaam van de tabel in de DB kan en mag wijzigen van de property name in Java), bijvoorbeeld voor temporele waardes waar enkel de tijd of datum wordt bijgehouden op DB niveau. Merk op dat <code>@Id</code> nodig is op een <code>@Entity</code> - zonder primary key kan JPA geen object persisteren. <code>@GeneratedValue</code> bestaat wanneer wij niet telkens de ID willen verhogen, maar dat willen overlaten aan de database vanwege de <code>AUTOINCREMENT</code>. Bij elke <code>persist()</code> gaat Hibernate de juiste volgende ID ophalen, dat zich vertaalt in de volgende queries in sysout:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#111">Hibernate</span><span style="color:#111">:</span> <span style="color:#00a8c8">select</span> <span style="color:#111">next_val</span> <span style="color:#00a8c8">as</span> <span style="color:#111">id_val</span> <span style="color:#00a8c8">from</span> <span style="color:#111">hibernate_sequence</span>
</span></span><span style="display:flex;"><span><span style="color:#111">Hibernate</span><span style="color:#111">:</span> <span style="color:#00a8c8">update</span> <span style="color:#111">hibernate_sequence</span> <span style="color:#00a8c8">set</span> <span style="color:#111">next_val</span><span style="color:#f92672">=</span> <span style="color:#f92672">?</span> <span style="color:#00a8c8">where</span> <span style="color:#111">next_val</span><span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span><span style="color:#111">Hibernate</span><span style="color:#111">:</span> <span style="color:#00a8c8">insert</span> <span style="color:#00a8c8">into</span> <span style="color:#111">Student</span> <span style="color:#111">(</span><span style="color:#111">goedBezig</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">studnr</span><span style="color:#111">)</span> <span style="color:#00a8c8">values</span> <span style="color:#111">(</span><span style="color:#f92672">?</span><span style="color:#111">,</span> <span style="color:#f92672">?</span><span style="color:#111">,</span> <span style="color:#f92672">?</span><span style="color:#111">,</span> <span style="color:#f92672">?</span><span style="color:#111">)</span>
</span></span></code></pre></div><p>De tabelnaam kan je wijzigen met de <code>@Table</code> annotatie op klasse niveau.</p>
<h4 id="insertsupdates">Inserts/updates</h4>
<p>Hoe bewaar ik een entity? <code>entityManager.persist(object)</code>. That&rsquo;s it!</p>
<p>Hoe update ik een entity, als properties zijn gewijzigd? <code>.merge(object)</code></p>
<p>Merk op dat in de Sysout output <em>geen query</em> wordt gegenereerd. Hibernate houdt alles in zijn interne cache bij, en zal pas flushen naar de database wanneer hij acht dat dat nodig is. Dat kan je zelf triggeren door <code>entityManager.flush()</code> te gebruiken (kan alleen in een transactie) - of het commando te wrappen met een transactie:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#111">entityManager</span><span style="color:#111">.</span><span style="color:#75af00">getTransaction</span><span style="color:#111">().</span><span style="color:#75af00">begin</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#111">entityManager</span><span style="color:#111">.</span><span style="color:#75af00">persist</span><span style="color:#111">(</span><span style="color:#111">dingdong</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#111">entityManager</span><span style="color:#111">.</span><span style="color:#75af00">getTransaction</span><span style="color:#111">().</span><span style="color:#75af00">commit</span><span style="color:#111">();</span>
</span></span></code></pre></div><p>Zonder dit, en met herbruik van dezelfde entity manager in SQLite, is er een kans dat je <code>SELECT</code> query niets teruggeeft, omdat de <code>INSERT</code> nog niet werd geflushed. De interne werking van combinatie JDBC+SQLite+JPA+Hibernate is zeer complex en zou een cursus van 20 studiepunten vereisen&hellip;</p>
<h4 id="queries">Queries</h4>
<p>Hoe query ik in JPA? Dit kan op verschillende manieren. We beperken ons hier tot de <strong>JPA Criteria API</strong>. Een voorbeeld. Gegeven een studentenlijst, waarvan we studenten willen teruggeven die als studnr &lt; 200. In SQL zou dit <code>SELECT * FROM student WHERE studnr &lt; 200</code> zijn. In Criteria API:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">var</span> <span style="color:#111">criteriaBuilder</span> <span style="color:#f92672">=</span> <span style="color:#111">entityManager</span><span style="color:#111">.</span><span style="color:#75af00">getCriteriaBuilder</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">var</span> <span style="color:#111">query</span> <span style="color:#f92672">=</span> <span style="color:#111">criteriaBuilder</span><span style="color:#111">.</span><span style="color:#75af00">createQuery</span><span style="color:#111">(</span><span style="color:#111">Student</span><span style="color:#111">.</span><span style="color:#75af00">class</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">var</span> <span style="color:#111">root</span> <span style="color:#f92672">=</span> <span style="color:#111">query</span><span style="color:#111">.</span><span style="color:#75af00">from</span><span style="color:#111">(</span><span style="color:#111">Student</span><span style="color:#111">.</span><span style="color:#75af00">class</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">query</span><span style="color:#111">.</span><span style="color:#75af00">where</span><span style="color:#111">(</span><span style="color:#111">criteriaBuilder</span><span style="color:#111">.</span><span style="color:#75af00">lt</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">.</span><span style="color:#75af00">get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;studnr&#34;</span><span style="color:#111">),</span> <span style="color:#111">200</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">return</span> <span style="color:#111">entityManager</span><span style="color:#111">.</span><span style="color:#75af00">createQuery</span><span style="color:#111">(</span><span style="color:#111">query</span><span style="color:#111">).</span><span style="color:#75af00">getResultList</span><span style="color:#111">();</span>
</span></span></code></pre></div><p>Voor simpele queries zoals deze is dat inderdaad omslachtig, maar de API is zeer krachtig en kan automatisch complexe queries genereren zonder dat wij ons moe moeten maken. Merk op dat wij <em>geen enkele letter SQL</em> zelf schrijven. Alles is <strong>java code</strong>, wat het eenvoudig maakt om te refactoren, redesignen, statische code analyse op te doen, unit testen, &hellip; Lees meer over criteria API:</p>
<ul>
<li>Voorbeeld 2 <a href="https://www.initgrep.com/posts/java/jpa/create-programmatic-queries-using-criteria-api">Programmatic Criteria Queries</a></li>
<li>Voorbeeld 3 <a href="https://www.tutorialspoint.com/jpa/jpa_criteria_api.htm">TutorialsPoint Criteria API</a></li>
<li>Voorbeeld 4 <a href="https://www.baeldung.com/jpa-criteria-api-in-expressions">Using &ldquo;In&rdquo; in Criteria API</a></li>
</ul>
<p>Controleer in de sysout output welke query Hibernate uiteindelijk genereert. Dat ziet er zo uit bijvoorbeeld:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a8c8">select</span> <span style="color:#111">student0_</span><span style="color:#111">.</span><span style="color:#111">studnr</span> <span style="color:#00a8c8">as</span> <span style="color:#111">studnr1_0_</span><span style="color:#111">,</span> <span style="color:#111">student0_</span><span style="color:#111">.</span><span style="color:#111">goedBezig</span> <span style="color:#00a8c8">as</span> <span style="color:#111">goedbezi2_0_</span><span style="color:#111">,</span> <span style="color:#111">student0_</span><span style="color:#111">.</span><span style="color:#111">naam</span> <span style="color:#00a8c8">as</span> <span style="color:#111">naam3_0_</span><span style="color:#111">,</span> <span style="color:#111">student0_</span><span style="color:#111">.</span><span style="color:#111">voornaam</span> <span style="color:#00a8c8">as</span> <span style="color:#111">voornaam4_0_</span> <span style="color:#00a8c8">from</span> <span style="color:#111">Student</span> <span style="color:#111">student0_</span> <span style="color:#00a8c8">where</span> <span style="color:#111">student0_</span><span style="color:#111">.</span><span style="color:#111">naam</span><span style="color:#f92672">=?</span>
</span></span></code></pre></div><h3 id="jdbc-met-sqlite-ideaal-voor-testing">Jdbc met SQLite: ideaal voor testing</h3>
<p>Willen we JPA met SQLite gebruiken moeten we natuurlijk onze <code>persistence.xml</code> aanpassen, maar ook nog een dependency toevoegen voor het juiste <code>hibernate.dialect</code>. Om vendor-specifieke queries te genereren moet Hibernate weten welke database wij hanteren. Dit staat los van de jdbc driver! Hiervoor gebruiken we voor SQLite dialect van dependency <code>implementation &quot;com.github.gwenn:sqlite-dialect:0.1.1&quot;</code>.</p>
<p>Dit komt dan overeen met volgende <code>persistence.xml</code>-file:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;persistence</span> <span style="color:#75af00">version=</span><span style="color:#d88200">&#34;2.1&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75af00">xmlns=</span><span style="color:#d88200">&#34;http://xmlns.jcp.org/xml/ns/persistence&#34;</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#75af00">xmlns:xsi=</span><span style="color:#d88200">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75af00">xsi:schemaLocation=</span><span style="color:#d88200">&#34;http://xmlns.jcp.org/xml/ns/persistence 
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                                 http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;persistence-unit</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;be.kuleuven.studenthibernate&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;description&gt;</span>Studenten JPA Test<span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;provider&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span style="color:#f92672">&lt;/provider&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;class&gt;</span>be.kuleuven.Student<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;class&gt;</span>be.kuleuven.Vak<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;class&gt;</span>be.kuleuven.Opleiding<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;exclude-unlisted-classes&gt;</span>false<span style="color:#f92672">&lt;/exclude-unlisted-classes&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- SQLite driver --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;javax.persistence.jdbc.driver&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;org.sqlite.JDBC&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- SQLite database file path --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;javax.persistence.jdbc.url&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;jdbc:sqlite:mydatabase.db&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- SQLite doesn&#39;t require username/password --&gt;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Schema generatie: drop en create bij elke run --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- UNCOMMENT HIERONDER ALS JE MET import.sql WIL WERKEN --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- &lt;property name=&#34;javax.persistence.schema-generation.database.action&#34; value=&#34;drop-and-create&#34;/&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Hibernate specifieke properties --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- &lt;property name=&#34;hibernate.dialect&#34; value=&#34;org.hibernate.community.dialect.SQLiteDialect&#34;/&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.dialect&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;org.sqlite.hibernate.dialect.SQLiteDialect&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.connection.autocommit&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.show_sql&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.flushMode&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;ALWAYS&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.cache.use_second_level_cache&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Needed for SQLite foreign key support --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;property</span> <span style="color:#75af00">name=</span><span style="color:#d88200">&#34;hibernate.connection.foreign_keys&#34;</span> <span style="color:#75af00">value=</span><span style="color:#d88200">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/persistence-unit&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/persistence&gt;</span>
</span></span></code></pre></div><p>Waar de grootste verschillen liggen bij de:</p>
<ul>
<li><code>persistence 'driver', 'url' ('user' en 'password')</code>.</li>
<li><code>hibernate dialect</code></li>
<li>en SQLite heeft voor &lsquo;foreign key&rsquo; support nog volgende property extra nodig: <code>&lt;property name=&quot;hibernate.connection.foreign_keys&quot; value=&quot;true&quot;/&gt;</code></li>
</ul>
<p><strong>OPMERKING</strong>: wil je in je <code>main</code> een configuratie gebruiken voor JPA en in de <code>test</code> een andere, dan moet je ook verschillende <code>persistence-unit</code> names voorzien bv: <code>&lt;persistence-unit name=&quot;be.kuleuven.studenthibernateTest&quot;&gt;</code></p>
<h3 id="demo-jpa-met-relations">DEMO: JPA met relations</h3>
<p>Het is het simpelste om die in een applicatie even te bekijken. Het belangrijkste zijn de juiste annotaties bij de verschillende klassen. Daarna zou alles automatisch moeten verlopen. Dat is toch wel handig.</p>
<!-- EXSOL -->
<p><strong><em><a href="../../files/jpa-relations.zip">Hier</a> vind je een zipfolder met een oplossing voor JPA demo Student met relations to Vak en Opleiding</em></strong></p>
<h2 id="opdracht">OPDRACHT</h2>
<p>Werk verder aan <a href="../../apis/opdracht#opdracht-jpa-met-als-deadline-vrijdag-2-mei-2025-23u59">de verplichte opdracht</a> waar je nu ook een JPA repository voor voorziet met een correct werkende <code>persistance.xml</code> en met de juiste dependencies.</p>
<!-- ### 2.2.3 Oefeningen

**Quickstart project**: `examples/hibernate-jpa-start` in de [cursus repository](https://github.com/kuleuven-Diepenbeek/db-course) ([download repo zip](https://github.com/KULeuven-Diepenbeek/db-course/archive/refs/heads/main.zip))

1. Het is opnieuw tijd voor onze studentendatabase. Open of kopiëer het project van [1. jdbc en jdbi](/apis/jdbc-jdbi/) (of start met het quickstart project). We voorzien een **derde implementatie** van de `StudentRepository` interface, naast de JDBC en Jdbi3 versies: `StudentRepositoryJpaImpl`. Probeer een nieuwe student te bewaren én daarna dezelfde student op te halen en af te drukken in sysout. Wat heb je daar weer voor nodig? (Scroll up!)
    - Een configuratiebestand in `resources/META-INF`.
    - Entities, zoals onze `Student` klasse.
    - Bootstrappen van de `EntityManager`.
    - Een repository implementatie die de `EntityManager` gebruikt (tip: _constructor injectie!_)
2. Modelleer ook de log tabel uit [1. Failures/rollbacks](/transacties/failures-rollbacks). Bewaar een log record bij elke wijziging van student (aanmaken, wijzigen). Vergeet geen `<class/>` entry toe te voegen in je `persistence.xml`! Anders krijg je de volgende fout: 

```
Exception in thread "main" java.lang.IllegalArgumentException: Not an entity: class be.kuleuven.studenthibernate.domain.Student
    at org.hibernate.metamodel.internal.MetamodelImpl.entity(MetamodelImpl.java:566)
    at org.hibernate.query.criteria.internal.QueryStructure.from(QueryStructure.java:127)
    at org.hibernate.query.criteria.internal.CriteriaQueryImpl.from(CriteriaQueryImpl.java:158)
```


### 2.2.4 JDBC VS Jdbi3 VS JPA

- JDBC: Low-level relationele mapping tussen Java en DB. Wordt door alle high-level API's gebruikt. Omslachtig (checked Exceptions, beperkte interface), erg kort bij SQL. Functionaliteit: minimaal. 
- Jdbi3: High-level relationele mapping no-nonsense API bovenop JDBC die in feite alle negatieve kenmerken van JDBC wegwerkt. Nog steeds kort bij SQL, maar meer object-friendly door Fluent/Declarative API. Functionaliteit: nog steeds basic, maar wel met gebruiksgemak. 
- JPA en vendors: High-level object-relational mapper bovenop JDBC waarbij entities centraal staan en compatibiliteit met Java EE is ingebouwd. Genereert SQL  (zelf raw queries schrijven kan nog steeds, maar wordt afgeraden). Functionaliteit: enorm uitgebreid. 

Kies altijd **bewust** voor één bepaald framework in plaats van "random" of "uit ervaring": JPA/Hibernate is vaak overkill voor simpele applicaties, JDBC is vaak té low-level en bevat veel boilerplating, terwijl Jdbi3 daartussen ligt. 

Zijn er nog alternatieven? Uiteraard, en meer dan één... Maar dat reikt buiten de scope van deze cursus. 

## 2.3 Many-to-one relaties in Hibernate/JPA

De grootste kracht van JPA hebben we nog steeds niet gezien: in plaats van één of meerdere entiteiten _onafhankelijk_ te mappen, kunnen we ook **relaties mappen** en Hibernate alles op SQL-niveau laten afhandelen. Nooit meer `JOIN` statements schrijven, hoera!... Niet altijd. Soms wil je de queries anders aanpakken dan Hibernate ze genereert omwille van **performantie** redenen. In dat geval zal je nog steeds moeten teruggrijpen naar _native SQL_ - of veel tijd investeren in de correcte configuratie van de Hibernate/JPA/JDBC installatie. 

Een concreet voorbeeld. Een `Docent` entiteit geeft les aan verschillende studenten:

<div class="devselect">

```kt
@Entity
data class Docent(
    @Id @GeneratedValue var docentennummer: Int,
    @Column var naam: String,
    @OneToMany(mappedBy = "docent") var studenten: List<Student>
)
```

```java
@Entity
public class Docent {
    @Id
    @GeneratedValue
    private int docentennummer;

    @Column
    private String naam;

    @OneToMany(mappedBy = "docent")
    private List<Student> studenten;
}
```
</div>

De `@OneToMany` annotatie zorgt voor de link tussen de studenten- en docententabel: het is wel nog nodig om een omgekeerde mapping property genaamd `docent` toe te voegen op de `Student` klasse: 

<div class="devselect">

```kt
@Entity
data class Student(
    // ...
    @ManyToOne(fetch = FetchType.LAZY) @JoinColumn(name = "docent_nr") var docent: Docent?
    )
```

```java
@Entity
public class Student {
    // ...
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "docent_nr")
    private Docent docent;
}
```
</div>

Op die manier kan je van docenten onmiddellijk zien aan wie ze lesgeven (one to many), en van een student van wie hij of zij les krijgt (many to one). De data wordt in de studententabel bewaard, in kolom `docent_nr`. Andere configuraties zoals tussentabellen zijn uiteraard ook mogelijk. 

Persisteren we nu een nieuwe docent waar een reeds bewaarde student in de lijst werd toegevoegd:

<div class="devselect">

```kt
private fun docentenTest(entityManager: EntityManager, student: Student) {
    val wouter: Docent("Wouter").apply {
        geefLesAan(student)
    }

    with(entityManager) {
        begin()
        persist(wouter)
        commit()
    }
}
```

```java
private static void docentenTest(EntityManager entityManager, Student student) {
    var wouter = new Docent("Wouter");
    wouter.geefLesAan(student);

    entityManager.getTransaction().begin();
    entityManager.persist(wouter);
    entityManager.getTransaction().commit();
}
```
</div>

Geeft in Hibernate:

```sql
Hibernate: select next_val as id_val from hibernate_sequence
Hibernate: update hibernate_sequence set next_val= ? where next_val=?
Hibernate: insert into Docent (naam, docentnummer) values (?, ?)
```

SQLite browser:

![](/img/student-nodocent.jpg)

Waar is onze `docent_nr` data? De methode `geefLesAan` voegt enkel toe aan de studentenlijst, maar de relatie moet **voor beide entities** kloppen:

<div class="devselect">

```kt
fun geefLesAan(student: Student) {
    studenten.add(student)
    student.docent = this
}
```

```java
public void geefLesAan(Student student) {
    studenten.add(student);
    student.setDocent(this);
}
```
</div>

Zonder de tweede regel wordt de kolom niet ingevuld. Geeft nu:

```sql
Hibernate: select next_val as id_val from hibernate_sequence
Hibernate: update hibernate_sequence set next_val= ? where next_val=?
Hibernate: insert into Docent (naam, docentnummer) values (?, ?)
Hibernate: update Student set docent_nr=?, goedBezig=?, naam=?, voornaam=? where studnr=?
```

Bingo, een `UPDATE` statement in de studententabel. SQLite Browser:

![](/img/student-docent.jpg)

### 2.3.1 Oefeningen

1. Implementeer de `Docent` klasse zoals hierboven. 
    - Wat gebeurt er als je studenten opvraagt? 
    - Wat gebeurt er als je een docent van een student opvraagt? De `FetchType.LAZY` schiet in gang. Verander dit naar `EAGER`. Kijk in de Hibernate output wat er verandert op SQL niveau en verifiëer dat er nu een `LEFT OUTER JOIN` in de `SELECT` van de student staat. 

Pas op het moment dat de data van de docent effectief nodig is, zoals bij het afdrukken, wordt een `SELECT` query gelanceerd bij lazy-loading. Bijvoorbeeld:

<div class="devselect">

```kt
val student = entityManager.find(Student::class.java, jos.studentennummer)
println("student ${student.naam}");
println(" -- heeft als docent ${student.docent.naam}")
```

```java
var student = entityManager.find(Student.class, jos.getStudentenNummer());
System.out.println("student " + student.getNaam());
System.out.println(" -- heeft als docent " + student.getDocent().getNaam());
```
</div>

Geeft als sysout output:

```
Hibernate: select student0_.studnr as studnr1_1_0_, student0_.docent_nr as docent_n5_1_0_, student0_.goedBezig as goedbezi2_1_0_, student0_.naam as naam3_1_0_, student0_.voornaam as voornaam4_1_0_ from Student student0_ where student0_.studnr=?
student Lowiemans
Hibernate: select docent0_.docentnummer as docentnu1_0_0_, docent0_.naam as naam2_0_0_ from Docent docent0_ where docent0_.docentnummer=?
 -- heeft als docent Wouter
```

Merk op dat de eerste `System.out.println` vóór de docenten `SELECT` query komt. Een eager-loaded docent geeft andere output:

```
Hibernate: select student0_.studnr as studnr1_1_0_, student0_.docent_nr as docent_n5_1_0_, student0_.goedBezig as goedbezi2_1_0_, student0_.naam as naam3_1_0_, student0_.voornaam as voornaam4_1_0_, docent1_.docentnummer as docentnu1_0_1_, docent1_.naam as naam2_0_1_ from Student student0_ left outer join Docent docent1_ on student0_.docent_nr=docent1_.docentnummer where student0_.studnr=?
student Lowiemans
 -- heeft als docent Wouter
```

**Tip**: `entityManager.clear()` of `close()` een nieuwe aanmaken kan helpen om de persistence context te flushen ter test. 
 -->

</article>

<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../apis/jdbi/" title="JDBI"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../apis/repository_interface/" title="Interface" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1747132609"></script>
    <script src="../../js/perfect-scrollbar.min.js?1747132609"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1747132609"></script>
    <script src="../../js/jquery.sticky.js?1747132609"></script>
    <script src="../../js/featherlight.min.js?1747132609"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1747132609"></script>
    <script src="../../js/learn.js?1747132609"></script>
    <script src="../../js/hugo-learn.js?1747132609"></script>
    <script src="../../js/mermaid.min.js?1747132609"></script>
    <script>
    window.MathJax = {
      chtml: {
        scale: 1,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

