<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/db-course/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=db-course/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.143.1">
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>JDBC en JDBI :: Databases</title>

    
    <link href="../../css/nucleus.css?1742303804" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1742303804" rel="stylesheet">
    <link href="../../css/hybrid.css?1742303804" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1742303804" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1742303804" rel="stylesheet">
    <link href="../../css/auto-complete.css?1742303804" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1742303804" rel="stylesheet">
    <link href="../../css/theme.css?1742303804" rel="stylesheet">
    <link href="../../css/autonumbering.css?1742303804" rel="stylesheet">
    <link href="../../css/devselector.css?1742303804" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1742303804" rel="stylesheet">
    <link href="../../css/theme-kul.css?1742303804" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1742303804"></script>
    <script src="../../js/devselector.js?1742303804"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../../apis/jdbc-jdbi/">
    <nav id="sidebar" class="">

  
  
  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
    <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../%20js/lunr.min.js?1742303804"></script>
<script type="text/javascript" src="../../%20js/auto-complete.js?1742303804"></script>
<script type="text/javascript">
    { { if hugo.IsMultilingual } }
    var baseurl = "http:\/\/localhost:1313\/db-course\/";
    { { else } }
    var baseurl = "http:\/\/localhost:1313\/db-course\/";
    { { end } }
</script>
<script type="text/javascript" src="../../%20js/search.js?1742303804"></script>
    
  </div>

  <div class="highlightable">

    <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

      
      
      







<li data-nav-id="/sql/" title="RDBMS" class="dd-item
        
        
        
        ">
  <a href="../../sql/">
    RDBMS
    
  </a>
  
  
  <ul>
    
    
    

    
    
    
    







<li data-nav-id="/sql/rdbms-basics/" title="Database Basics" class="dd-item ">
  <a href="../../sql/rdbms-basics/">
    Database Basics
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/sql/rdbms-components/" title="Database Componenten" class="dd-item ">
  <a href="../../sql/rdbms-components/">
    Database Componenten
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/sql/rdbms-acid/" title="ACID" class="dd-item ">
  <a href="../../sql/rdbms-acid/">
    ACID
    
  </a>
</li>




    
    
    
  </ul>
  
</li>



      
      







<li data-nav-id="/sql-ddl-dml/" title="SQL DDL &amp; DML" class="dd-item
        
        
        
        ">
  <a href="../../sql-ddl-dml/">
    SQL DDL &amp; DML
    
  </a>
  
  
  <ul>
    
    
    

    
    
    
    







<li data-nav-id="/sql-ddl-dml/ddl/" title="DDL" class="dd-item ">
  <a href="../../sql-ddl-dml/ddl/">
    DDL
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/sql-ddl-dml/dml/" title="DML" class="dd-item ">
  <a href="../../sql-ddl-dml/dml/">
    DML
    
  </a>
</li>




    
    
    
  </ul>
  
</li>



      
      







<li data-nav-id="/apis/" title="Database APIs" class="dd-item
        parent
        
        
        ">
  <a href="../../apis/">
    Database APIs
    
  </a>
  
  
  <ul>
    
    
    

    
    
    
    







<li data-nav-id="/apis/basics/" title="API Basics" class="dd-item ">
  <a href="../../apis/basics/">
    API Basics
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/apis/jdbc-jdbi/" title="JDBC en JDBI" class="dd-item active">
  <a href="../../apis/jdbc-jdbi/">
    JDBC en JDBI
    
  </a>
</li>




    
    
    
  </ul>
  
</li>



      
      







<li data-nav-id="/transacties/" title="RDBMS Transacties" class="dd-item
        
        
        
        ">
  <a href="../../transacties/">
    RDBMS Transacties
    
  </a>
  
  
  <ul>
    
    
    

    
    
    
    







<li data-nav-id="/transacties/acid/" title="ACID" class="dd-item ">
  <a href="../../transacties/acid/">
    ACID
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/transacties/basics/" title="Transaction Mgmt. Basics" class="dd-item ">
  <a href="../../transacties/basics/">
    Transaction Mgmt. Basics
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/transacties/concurrency-control/" title="Concurrency Control" class="dd-item ">
  <a href="../../transacties/concurrency-control/">
    Concurrency Control
    
  </a>
</li>




    
    
    
    







<li data-nav-id="/transacties/failures-rollbacks/" title="Failures-Rollbacks" class="dd-item ">
  <a href="../../transacties/failures-rollbacks/">
    Failures-Rollbacks
    
  </a>
</li>




    
    
    
  </ul>
  
</li>



      
      
    </ul>

    
    
    <section id="shortcuts">
      <h3>More</h3>
      <ul>
        
        <li>
          <a class="padding" href="https://studiegidswww.uhasselt.be/opleidingsonderdeel.aspx?a=2025&amp;i=4290"><i class='fa fa-university'></i> ECTS Sheet</a>
        </li>
        
        <li>
          <a class="padding" href="https://toledo.kuleuven.be/portal/"><i class='fa fa-university'></i> Toledo</a>
        </li>
        
        <li>
          <a class="padding" href="https://github.com/kuleuven-diepenbeek/db-course/"><i class='fab fa-github'></i> Course Git Repository</a>
        </li>
        
      </ul>
    </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>



        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Index</a> > <a href='../../apis/'>Database APIs</a> > JDBC en JDBI
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
  <div class="wrapper toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#java-database-connectivity-jdbc">Java Database Connectivity (JDBC)</a>
      <ul>
        <li><a href="#hoe-verbind-ik-java-met-de-db">Hoe verbind ik Java met de DB?</a></li>
        <li><a href="#queriesobjecten-in-jdbc">Queries/Objecten in JDBC</a></li>
        <li><a href="#demos">Demos</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              JDBC en JDBI
            </h1>
          

        

        





<article class='content'>
<h2 id="java-database-connectivity-jdbc">Java Database Connectivity (JDBC)</h2>
<h3 id="hoe-verbind-ik-java-met-de-db">Hoe verbind ik Java met de DB?</h3>
<p><a href="https://www.tutorialspoint.com/jdbc/index.htm">JDBC</a> is een interface in de JDK die ons in staat stelt om een connectie te openen naar een database. <strong>JDBC is een API</strong>: een abstracitelaag of een <em>protocol</em>. Dit betekent dat we met JDBC kunnen verbinden naar eender welke server van eender welke flavor: een Oracle SQL, MSSQL, of SQLite database. De database <em>vendor</em> wordt verborgen achter de JDBC laag. Voor deze oefeningen beperken we ons tot MySQL.</p>
<p>Voor elke database moet er dus een vendor-specifieke driver als dependency worden toegevoegd. In het geval van MySQL is dit de <a href="https://mvnrepository.com/artifact/mysql/mysql-connector-java">mysql-jdbc</a> driver, de <code>mysql-jdbc</code> package. JDBC zelf leeft in <code>java.sql</code> en is een integraal onderdeel van de JDK: dit moeten we dus niet apart oplijsten als dependency of downloaden.</p>

<div class="mermaid" align="left" >
	
graph LR;
    Java[Java]
    JDBC[JDBC]
    MYSQL[MySQL-JDBC]
    DB[(MySQL Database)]
    subgraph Java space
    subgraph JDK
    Java -.-> JDBC
    end
    JDBC --> MYSQL
    end
    subgraph DB space
    MYSQL --> DB
    end

</div>
<p>De <code>mysql-jdbc</code> package zorgt voor de brug tussen onze Java applicatie en de database, maar we spreken die aan via JDBC.</p>
<p>Enkele belangrijke statements:</p>
<ol>
<li>Een connectie naar een database vastleggen: <code>var connection = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/&lt;database_name&gt;&quot;, &quot;root&quot;, &quot;&quot;);</code></li>
<li>Een <code>SELECT</code> query uitvoeren: <code>var s = connection.createStatement(); var result = s.executeQuery(&quot;...&quot;); var cell = result.getString(&quot;&lt;column_name&gt;&quot;);</code></li>
<li>Een <code>INSERT</code>/<code>UPDATE</code>/&hellip; query uitvoeren (die de structuur of inhoud van de database <strong>wijzigt</strong>): <code>var s = connection.createStatement(); s.executeUpdate(&quot;...&quot;);</code></li>
</ol>
<p>Het volgende voorbeeld opent een verbinding naar een DB, maakt een tabel aan, voegt een record toe, en telt het aantal records:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">private</span> <span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">createDb</span><span style="color:#111">()</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">SQLException</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">connection</span> <span style="color:#f92672">=</span> <span style="color:#111">DriverManager</span><span style="color:#111">.</span><span style="color:#75af00">getConnection</span><span style="color:#111">(</span><span style="color:#d88200">&#34;jdbc:mysql://localhost:3306/school&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;root&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;CREATE TABLE student(nr INT); INSERT INTO student(nr) VALUES(1);&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">verifyDbContents</span><span style="color:#111">()</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">SQLException</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeQuery</span><span style="color:#111">(</span><span style="color:#d88200">&#34;SELECT COUNT(*) FROM student;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">count</span> <span style="color:#f92672">=</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getInt</span><span style="color:#111">(</span><span style="color:#111">0</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">assert</span> <span style="color:#111">count</span> <span style="color:#f92672">==</span> <span style="color:#111">1</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><p><strong>Gradle</strong> dependency: ``</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#75715e">// https://mvnrepository.com/artifact/mysql/mysql-connector-java
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#111">implementation</span> <span style="color:#d88200">&#39;mysql:mysql-connector-java:5.1.6&#39;</span>
</span></span></code></pre></div><p>Merk op dat <code>SQLException</code> een <strong>checked exception</strong> is die je constant moet meespelen in de method signature of expliciet moet opvangen. Het probleem van een <code>try { } catch { } finally { }</code> block is dat in de finally je ook geen <code>close()</code> kan uitvoeren zonder opnieuw een <code>try</code> block te openen&hellip; Inception!</p>
<p>Het <code>connection.close()</code> statement moet er voor zorgen dat voor elke request de connection netjes wordt afgesloten. Een database heeft meestal een <strong>connection pool</strong> van x aantal beschikbare connections, bijvoorbeeld 5. Als een connection per request niet wordt gesloten, heeft de volgende bezoeker van onze website geen enkele kans om zijn search query te lanceren, omdat de database dan zegt dat alle connecties zijn opgebruikt!</p>
<p>Merk op dat de String <code>jdbc:mysql://localhost:3306/school</code> een <strong>connectie met je MariaDB</strong> aanmaakt en de meegegeven database, zodat je met PHPmyAdmin data kan inspecteren. Indien je een tabel aanmaakt de eerste keer, gaat dit de tweede keer crashen met <em>table already exists</em>. Houd hier dus rekening mee (e.v.t. met <code>IF NOT EXISTS</code>). Je kan ook een <strong>in-memory database</strong> aanmaken, die volledig in RAM leeft en bij elke opstart opnieuw wordt aangemaakt, met de String <code>jdbc:sqlite:memory</code>. (Hiervoor gebruiken we dan de <a href="https://github.com/xerial/sqlite-jdbc">sqlite JDBC-connector</a>, hier gaan we in deze cursus echter niet verder op in.)</p>
<p>Werk je met een andere database maar heb je geen idee hoe die speciale connection string te vormen? Geen probleem, daarvoor dient <a href="https://www.connectionstrings.com/">https://www.connectionstrings.com/</a>. Bijvoorbeeld, een connectie naar de Microsoft Azure cloud kan met de volgende syntax:</p>
<pre tabindex="0"><code>Server=tcp:myserver.database.windows.net,1433;Database=myDataBase;User ID=mylogin@myserver;Password=myPassword;Trusted_Connection=False;Encrypt=True;
</code></pre><p>Het is de connection string die bepaalt welke dependency binding gebruikt wordt! Dit noemen we <em>late binding</em>: er is <strong>geen expliciete referentie</strong> naar iets van MySQL in de Java code; we werken <em>enkel</em> met JDBC zelf. Als je de vendor driver vergeet toe te voegen als Gradle dependency gebeurt er dit:</p>
<pre tabindex="0"><code>Exception in thread &#34;main&#34; java.sql.SQLException: No suitable driver found for jdbc:mysql://localhost:3306/school
    at java.sql/java.mysql.DriverManager.getConnection(DriverManager.java:702)
    at java.sql/java.mysql.DriverManager.getConnection(DriverManager.java:251)
    at Demo.main(Demo.java:8)
</code></pre>
<div class="notices note" ><p>In-memory databases (ConStr. <code>jdbc:sqlite:memory</code>), die met een lege database vertrekken, en constant <code>CREATE TABLE()</code> statements issuen, vervuilen je broncode. Als je veel SQL moet uitvoeren is het beter om dit in een <code>.sql</code> bestand te bewaren in <code>src/main/resources</code> en eenmalig in te lezen als SQL met <code>new String(Files.readAllBytes(Paths.g));</code>, om te kunnen uitvoeren via <code>statement.executeUpdate()</code>.</p>
</div>

<p>Bijvoorbeeld voor onze casus:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">private</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">initTables</span><span style="color:#111">()</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">Exception</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">Connection</span> <span style="color:#111">connection</span> <span style="color:#f92672">=</span> <span style="color:#111">DriverManager</span><span style="color:#111">.</span><span style="color:#75af00">getConnection</span><span style="color:#111">(</span><span style="color:#d88200">&#34;jdbc:mysql://localhost:3306/tennisvlaanderen&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;root&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">create_tables_sql</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">String</span><span style="color:#111">(</span><span style="color:#111">Files</span><span style="color:#111">.</span><span style="color:#75af00">readAllBytes</span><span style="color:#111">(</span><span style="color:#111">Paths</span><span style="color:#111">.</span><span style="color:#75af00">get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;src/main/resources/create_tables.sql&#34;</span><span style="color:#111">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">populate_tables_sql</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">String</span><span style="color:#111">(</span><span style="color:#111">Files</span><span style="color:#111">.</span><span style="color:#75af00">readAllBytes</span><span style="color:#111">(</span><span style="color:#111">Paths</span><span style="color:#111">.</span><span style="color:#75af00">get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;src/main/resources/populate_tables_with_testdata.sql&#34;</span><span style="color:#111">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#111">create_tables_sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#111">populate_tables_sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#111">create_tables_sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#111">populate_tables_sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><h3 id="queriesobjecten-in-jdbc">Queries/Objecten in JDBC</h3>
<p>Stel dat we het eerste voorbeeld van een school database willen uitbreiden en studenten die in de database opgeslagen zijn willen inladen in een <code>Student</code> klasse instantie: van de <code>TABLE STUDENT</code> naar de <code>class Student</code>. In geval van JDBC is dat veel handwerk:</p>
<ol>
<li>Maak een verbinding met de database.</li>
<li>Voer de <code>SELECT</code> statements uit.</li>
<li>Loop door de <code>ResultSet</code> en maak een nieuwe <code>Student</code> instantie aan. Vang alle mogelijke fouten zelf op: wat met lege kolommen, <code>null</code>? Wat met <code>INTEGER</code> kolommen die je wilt mappen op een <code>String</code> property?</li>
</ol>
<p>Om van de huidige resultatenrij naar de volgende te springen in <code>ResultSet</code> gebruikt men de methode <code>next()</code> in een typisch <code>while()</code> formaat:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">var</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">executeQuery</span><span style="color:#111">(</span><span style="color:#d88200">&#34;SELECT * FROM &lt;table_name&gt;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">while</span><span style="color:#111">(</span><span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">next</span><span style="color:#111">())</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">var</span> <span style="color:#111">eenString</span> <span style="color:#f92672">=</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;&lt;column_name&gt;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// doe iets!</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><p>Zie ook <a href="https://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html">ResultSet Oracle Javadoc</a>.</p>
<p>Aangezien we reeds hebben kennis gemaakt met de (beperkte) API, schakelen we onmiddellijk over naar de oefeningen:</p>
<h3 id="demos">Demos</h3>
<p>We gebruiken de <code>student</code> tabel statements uit <em>RDBMS Transacties - Failures &amp; Rollbacks</em> maar nu met MySQL syntax:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Drop tables if they exist
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#00a8c8">DROP</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#00a8c8">IF</span> <span style="color:#00a8c8">EXISTS</span> <span style="color:#111">student</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Create student table
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#111">student</span> <span style="color:#111">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">studnr</span> <span style="color:#111">INT</span> <span style="color:#00a8c8">NOT</span> <span style="color:#00a8c8">NULL</span> <span style="color:#00a8c8">PRIMARY</span> <span style="color:#00a8c8">KEY</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">naam</span> <span style="color:#111">VARCHAR</span><span style="color:#111">(</span><span style="color:#ae81ff">200</span><span style="color:#111">)</span> <span style="color:#00a8c8">NOT</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">voornaam</span> <span style="color:#111">VARCHAR</span><span style="color:#111">(</span><span style="color:#ae81ff">200</span><span style="color:#111">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">goedbezig</span> <span style="color:#111">BOOL</span>
</span></span><span style="display:flex;"><span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Insert sample data into student
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#00a8c8">INSERT</span> <span style="color:#00a8c8">INTO</span> <span style="color:#111">student</span> <span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedbezig</span><span style="color:#111">)</span> <span style="color:#00a8c8">VALUES</span>
</span></span><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#ae81ff">123</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Trekhaak&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Jaak&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">),</span>
</span></span><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#ae81ff">456</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Peeters&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Jos&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">),</span>
</span></span><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#ae81ff">890</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Dongmans&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Ding&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
</span></span></code></pre></div><p>We maken hier weer gebruik van Gradle, maar aangezien onze database op onze Windows host draait gaan we geen verbinding kunnen maken via onze WSL. Daarom moeten we eerst nog even Gradle voor windows installeren. De stappen daarvoor vind je <a href="https://docs.gradle.org/current/userguide/installation.html#ex-installing-manually">hier</a>. <em>(Je kan ook je bestanden aanmaken in je WSL en dan de projectmap kopiëren naar je windows file explorer. Dan kan je de Gradle wrapper voor Windows gebruiken <code>./gradle.bat</code>)</em></p>
<h4 id="alles-in-de-main">Alles in de main</h4>
<p>Om dingen te doen met de database moeten we dus een aantal stappen doorlopen, die hier beschreven en gecodeerd zijn in een <code>main</code>-method:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">static</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">main</span><span style="color:#111">(</span><span style="color:#111">String</span><span style="color:#f92672">[]</span> <span style="color:#111">args</span><span style="color:#111">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">Statement</span> <span style="color:#111">statement</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">ResultSet</span> <span style="color:#111">result</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">try</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// CONNECT TO MYSQL</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">connection</span> <span style="color:#f92672">=</span> <span style="color:#111">DriverManager</span><span style="color:#111">.</span><span style="color:#75af00">getConnection</span><span style="color:#111">(</span><span style="color:#d88200">&#34;jdbc:mysql://localhost:3306/school&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;root&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// CREATE THE TABLES</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">String</span> <span style="color:#111">sqlString</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            -- Drop tables if they exist
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            DROP TABLE IF EXISTS student;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            -- Create student table
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            CREATE TABLE student (
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                                studnr INT NOT NULL PRIMARY KEY,
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                                naam VARCHAR(200) NOT NULL,
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                                voornaam VARCHAR(200),
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                                goedbezig BOOL
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            );
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            -- Insert sample data into student
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            INSERT INTO student (studnr, naam, voornaam, goedbezig) VALUES
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            (123, &#39;Trekhaak&#39;, &#39;Jaak&#39;, 0),
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            (456, &#39;Peeters&#39;, &#39;Jos&#39;, 0),
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            (890, &#39;Dongmans&#39;, &#39;Ding&#39;, 1);
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                            &#34;&#34;&#34;</span> <span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#111">sqlString</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//VERIFY DATABASE CONTENT</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">=</span> <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">executeQuery</span><span style="color:#111">(</span><span style="color:#d88200">&#34;SELECT COUNT(*) as cnt FROM student;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">next</span><span style="color:#111">()){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Assert that number of rows is 3: &#34;</span><span style="color:#f92672">+</span>  <span style="color:#111">(</span><span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getInt</span><span style="color:#111">(</span><span style="color:#d88200">&#34;cnt&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">==</span> <span style="color:#111">3</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">assert</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getInt</span><span style="color:#111">(</span><span style="color:#d88200">&#34;cnt&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">==</span> <span style="color:#111">3</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span><span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">Exception</span> <span style="color:#111">e</span><span style="color:#111">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">printStackTrace</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//READ FROM DB</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">executeQuery</span><span style="color:#111">(</span><span style="color:#d88200">&#34;SELECT * FROM student;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">next</span><span style="color:#111">()){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Studnr: &#34;</span><span style="color:#f92672">+</span><span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getInt</span><span style="color:#111">(</span><span style="color:#d88200">&#34;studnr&#34;</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">printStackTrace</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//UPDATE DB</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;UPDATE student SET voornaam = &#39;Jaqueline&#39; WHERE studnr = 123;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span><span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">e</span><span style="color:#111">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">printStackTrace</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// OPTIONAL VERIFY UPDATE WITH A READ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Closing all connections correctly</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">result</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">null</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Error closing resultset: &#34;</span><span style="color:#f92672">+</span><span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">toString</span><span style="color:#111">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">statement</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">null</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">statement</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Error closing statement: &#34;</span><span style="color:#f92672">+</span><span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">toString</span><span style="color:#111">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">connection</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">null</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Error closing connection: &#34;</span><span style="color:#f92672">+</span><span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">toString</span><span style="color:#111">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><h4 id="opsplitsen-in-verschillende-methoden">Opsplitsen in verschillende methoden</h4>
<p>Je merkt onmiddellijk dat deze code onoverzichtelijk is, je kan dus beter verschillende methoden aanmaken en dan oproepen in de <code>main</code>-method. We splitsen op in:</p>
<ul>
<li><code>public static void connectToDbMysql(String connectionString, String user, String pwd)</code></li>
<li><code>public static void createDbMysql()</code></li>
<li><code>public static void verifyDbContents()</code></li>
<li><code>public static ResultSet readFromDb(String query)</code></li>
<li><code>public static void updateDb(String updateStr)</code></li>
<li><code>public static void closeAllConnections()</code></li>
</ul>
<p><em>Dit laten we als een oefening voor de student.</em></p>
<h4 id="opsplitsen-van-verantwoordelijkheden-in-verschillende-klasses">Opsplitsen van verantwoordelijkheden in verschillende klasses</h4>
<p>Wanneer we nu met meerdere databases en meerdere tabellen werken gaat het niet meer overzichtelijk zijn om alles in dezelfde klasse te doen, daarom gaan we verantwoordelijkheden opsplitsen in verschillende klassen:</p>
<ul>
<li><code>ConnectionManager</code> klasse die instaat voor de verbinding met de database.</li>
<li><code>&lt;naam&gt;Repository</code> klasse die instaat voor de logica die te maken heeft met queries uitvoeren die over een bepaalde model klasse gaan bv. We hebben een klasse <code>Student</code> en een tabel <code>student</code> dan komt in de StudentRepository alle code om onder andere data uit de studententabel op te halen en om te vormen tot echte student objecten in Java.</li>
<li>In de main komt dan alles samen, data ophalen uit database en omvormen tot Java objecten en dan die objecten gebruiken.</li>
</ul>
<p>We maken en testen een klasse <code>StudentRepository</code> die de volgende methode implementeert. Zoals je ziet is het de bedoeling dat de JDBC <code>Connection</code> instance elders wordt aangemaakt, bijvoorbeeld in een <strong>aparte</strong> <code>ConnectionManager</code> klasse.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">StudentRepository</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#75af00">StudentRepository</span><span style="color:#111">(</span><span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#111">List</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span> <span style="color:#75af00">getStudentsByName</span><span style="color:#111">(</span><span style="color:#111">String</span> <span style="color:#111">name</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><details closed>
<summary><i><b>Klik hier voor de volledige implementatie van de <code>StudentRepository</code> klasse </b></i>🔽</summary>
<p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#111">be.kuleuven.student</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.sql.*</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.util.ArrayList</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.util.List</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">StudentRepository</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">final</span> <span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#75af00">StudentRepository</span><span style="color:#111">(</span><span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">connection</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#111">List</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span> <span style="color:#75af00">getStudentsByName</span><span style="color:#111">(</span><span style="color:#111">String</span> <span style="color:#111">name</span><span style="color:#111">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">ArrayList</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span> <span style="color:#111">resultList</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">ArrayList</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">Statement</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">String</span> <span style="color:#111">stmt</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;SELECT * FROM student WHERE naam = &#39;&#34;</span> <span style="color:#f92672">+</span> <span style="color:#111">name</span> <span style="color:#f92672">+</span> <span style="color:#d88200">&#34;&#39;&#34;</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">ResultSet</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeQuery</span><span style="color:#111">(</span><span style="color:#111">stmt</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">while</span><span style="color:#111">(</span><span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">next</span><span style="color:#111">())</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#00a8c8">int</span> <span style="color:#111">studnr</span> <span style="color:#f92672">=</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getInt</span><span style="color:#111">(</span><span style="color:#d88200">&#34;studnr&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">String</span> <span style="color:#111">naam</span>  <span style="color:#f92672">=</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;naam&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">String</span> <span style="color:#111">voornaam</span> <span style="color:#f92672">=</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;voornaam&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#00a8c8">boolean</span> <span style="color:#111">goedbezig</span> <span style="color:#f92672">=</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getBoolean</span><span style="color:#111">(</span><span style="color:#d88200">&#34;goedbezig&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">resultList</span><span style="color:#111">.</span><span style="color:#75af00">add</span><span style="color:#111">(</span><span style="color:#00a8c8">new</span> <span style="color:#111">Student</span><span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedbezig</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span><span style="color:#111">(</span><span style="color:#111">Exception</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">throw</span> <span style="color:#00a8c8">new</span> <span style="color:#111">RuntimeException</span><span style="color:#111">(</span><span style="color:#111">e</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">resultList</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">};</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div></p>
</details>
<details closed>
<summary><i><b>Klik hier voor de volledige implementatie van de <code>Student</code> klasse </b></i>🔽</summary>
<p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#111">be.kuleuven.student</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.util.Objects</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">Student</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">int</span> <span style="color:#111">studnr</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#111">String</span> <span style="color:#111">naam</span><span style="color:#111">,</span><span style="color:#111">voornaam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">boolean</span> <span style="color:#111">goedBezig</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#75af00">Student</span><span style="color:#111">(){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#75af00">Student</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">String</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">String</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#00a8c8">boolean</span> <span style="color:#111">goedBezig</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">studnr</span> <span style="color:#f92672">=</span> <span style="color:#111">studnr</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">naam</span> <span style="color:#f92672">=</span> <span style="color:#111">naam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">voornaam</span> <span style="color:#f92672">=</span> <span style="color:#111">voornaam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">goedBezig</span> <span style="color:#f92672">=</span> <span style="color:#111">goedBezig</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">int</span> <span style="color:#75af00">getStudnr</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">studnr</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setStudnr</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">studnr</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">studnr</span> <span style="color:#f92672">=</span> <span style="color:#111">studnr</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#111">String</span> <span style="color:#75af00">getNaam</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">naam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setNaam</span><span style="color:#111">(</span><span style="color:#111">String</span> <span style="color:#111">naam</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">naam</span> <span style="color:#f92672">=</span> <span style="color:#111">naam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#111">String</span> <span style="color:#75af00">getVoornaam</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">voornaam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setVoornaam</span><span style="color:#111">(</span><span style="color:#111">String</span> <span style="color:#111">voornaam</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">voornaam</span> <span style="color:#f92672">=</span> <span style="color:#111">voornaam</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">boolean</span> <span style="color:#75af00">isGoedBezig</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">goedBezig</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setGoedBezig</span><span style="color:#111">(</span><span style="color:#00a8c8">boolean</span> <span style="color:#111">goedBezig</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">goedBezig</span> <span style="color:#f92672">=</span> <span style="color:#111">goedBezig</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75af00">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#111">String</span> <span style="color:#75af00">toString</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#d88200">&#34;Student{&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#34;studnr=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#111">studnr</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#34;, naam=&#39;&#34;</span> <span style="color:#f92672">+</span> <span style="color:#111">naam</span> <span style="color:#f92672">+</span> <span style="color:#d88200">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#34;, voornaam=&#39;&#34;</span> <span style="color:#f92672">+</span> <span style="color:#111">voornaam</span> <span style="color:#f92672">+</span> <span style="color:#d88200">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#34;, goedBezig=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#111">goedBezig</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#39;}&#39;</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75af00">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">boolean</span> <span style="color:#75af00">equals</span><span style="color:#111">(</span><span style="color:#111">Object</span> <span style="color:#111">o</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#00a8c8">this</span> <span style="color:#f92672">==</span> <span style="color:#111">o</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">true</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">o</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">null</span> <span style="color:#f92672">||</span> <span style="color:#111">getClass</span><span style="color:#111">()</span> <span style="color:#f92672">!=</span> <span style="color:#111">o</span><span style="color:#111">.</span><span style="color:#75af00">getClass</span><span style="color:#111">())</span> <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">false</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">Student</span> <span style="color:#111">student</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">Student</span><span style="color:#111">)</span> <span style="color:#111">o</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">studnr</span> <span style="color:#f92672">==</span> <span style="color:#111">student</span><span style="color:#111">.</span><span style="color:#75af00">studnr</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">Objects</span><span style="color:#111">.</span><span style="color:#75af00">equals</span><span style="color:#111">(</span><span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">student</span><span style="color:#111">.</span><span style="color:#75af00">naam</span><span style="color:#111">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">Objects</span><span style="color:#111">.</span><span style="color:#75af00">equals</span><span style="color:#111">(</span><span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">student</span><span style="color:#111">.</span><span style="color:#75af00">voornaam</span><span style="color:#111">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">Objects</span><span style="color:#111">.</span><span style="color:#75af00">equals</span><span style="color:#111">(</span><span style="color:#111">goedBezig</span><span style="color:#111">,</span> <span style="color:#111">student</span><span style="color:#111">.</span><span style="color:#75af00">goedBezig</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75af00">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">int</span> <span style="color:#75af00">hashCode</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">Objects</span><span style="color:#111">.</span><span style="color:#75af00">hash</span><span style="color:#111">(</span><span style="color:#111">studnr</span><span style="color:#111">,</span> <span style="color:#111">naam</span><span style="color:#111">,</span> <span style="color:#111">voornaam</span><span style="color:#111">,</span> <span style="color:#111">goedBezig</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div></p>
</details>
<details closed>
<summary><i><b>Klik hier voor de volledige implementatie van de <code>ConnectionManager</code> klasse </b></i>🔽</summary>
<p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#111">be.kuleuven</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.nio.file.Files</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.nio.file.Paths</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.sql.*</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">ConnectionManager</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#111">String</span> <span style="color:#111">connectionString</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#75af00">ConnectionManager</span><span style="color:#111">(</span><span style="color:#111">String</span> <span style="color:#111">connectionString</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">this</span><span style="color:#111">.</span><span style="color:#75af00">connectionString</span> <span style="color:#f92672">=</span> <span style="color:#111">connectionString</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">connection</span> <span style="color:#f92672">=</span> <span style="color:#111">DriverManager</span><span style="color:#111">.</span><span style="color:#75af00">getConnection</span><span style="color:#111">(</span><span style="color:#111">connectionString</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">setAutoCommit</span><span style="color:#111">(</span><span style="color:#00a8c8">false</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">initTables</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">verifyTableContents</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">Exception</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Db connection handle failure&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">e</span><span style="color:#111">.</span><span style="color:#75af00">printStackTrace</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">throw</span> <span style="color:#00a8c8">new</span> <span style="color:#111">RuntimeException</span><span style="color:#111">(</span><span style="color:#111">e</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#111">Connection</span> <span style="color:#75af00">getConnection</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">connection</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#111">String</span> <span style="color:#75af00">getConnectionString</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">connectionString</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">flushConnection</span><span style="color:#111">()</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">commit</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">throw</span> <span style="color:#00a8c8">new</span> <span style="color:#111">RuntimeException</span><span style="color:#111">(</span><span style="color:#111">e</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">initTables</span><span style="color:#111">()</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">Exception</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">String</span> <span style="color:#111">sql</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">String</span><span style="color:#111">(</span><span style="color:#111">Files</span><span style="color:#111">.</span><span style="color:#75af00">readAllBytes</span><span style="color:#111">(</span><span style="color:#111">Paths</span><span style="color:#111">.</span><span style="color:#75af00">get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;src/main/resources/dbcreate.sql&#34;</span><span style="color:#111">)));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#111">sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">Statement</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeUpdate</span><span style="color:#111">(</span><span style="color:#111">sql</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">verifyTableContents</span><span style="color:#111">()</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">SQLException</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">Statement</span> <span style="color:#111">s</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">createStatement</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">ResultSet</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#75af00">executeQuery</span><span style="color:#111">(</span><span style="color:#d88200">&#34;SELECT COUNT(*) as cnt FROM student&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">assert</span> <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#75af00">getInt</span><span style="color:#111">(</span><span style="color:#d88200">&#34;cnt&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">==</span> <span style="color:#111">3</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div></p>
</details>
<details closed>
<summary><i><b>Klik hier voor een voorbeeld van de <code>Main</code> klasse waar we bovenstaande klassen gebruiken </b></i>🔽</summary>
<p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#111">be.kuleuven</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">be.kuleuven.student.Student</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">be.kuleuven.student.StudentRepository</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.sql.*</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">java.util.List</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">Main</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">static</span> <span style="color:#111">Statement</span> <span style="color:#111">statement</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">null</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">private</span> <span style="color:#00a8c8">static</span> <span style="color:#111">ResultSet</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">null</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">static</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">main</span><span style="color:#111">(</span><span style="color:#111">String</span><span style="color:#f92672">[]</span> <span style="color:#111">args</span><span style="color:#111">)</span> <span style="color:#00a8c8">throws</span> <span style="color:#111">SQLException</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">ConnectionManager</span> <span style="color:#111">cm</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">ConnectionManager</span><span style="color:#111">(</span><span style="color:#d88200">&#34;jdbc:mysql://localhost:3306/school&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;root&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">cm</span><span style="color:#111">.</span><span style="color:#75af00">flushConnection</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">Connection</span> <span style="color:#111">connection</span> <span style="color:#f92672">=</span> <span style="color:#111">cm</span><span style="color:#111">.</span><span style="color:#75af00">getConnection</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">StudentRepository</span> <span style="color:#111">studentRepository</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">StudentRepository</span><span style="color:#111">(</span><span style="color:#111">cm</span><span style="color:#111">.</span><span style="color:#75af00">getConnectionString</span><span style="color:#111">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">List</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">studentRepository</span><span style="color:#111">.</span><span style="color:#75af00">getStudentsByName</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Jaak&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#111">Student</span> <span style="color:#111">s</span><span style="color:#111">:</span> <span style="color:#111">result</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#111">s</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div></p>
</details>
<p><strong>Enkele vragen/oefeningen:</strong></p>
<ol>
<li>Breid de <code>StudentRepository</code>-klasse uit met de volgende methoden (CREATE, READ, UPDATE, DELETE = <strong>CRUD</strong>):</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#00a8c8">public</span> <span style="color:#00a8c8">class</span> <span style="color:#75af00">StudentRepository</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#75af00">StudentRepository</span><span style="color:#111">(</span><span style="color:#111">Connection</span> <span style="color:#111">connection</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#111">List</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span> <span style="color:#75af00">getStudentsByName</span><span style="color:#111">(</span><span style="color:#111">String</span> <span style="color:#111">name</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#111">List</span><span style="color:#f92672">&lt;</span><span style="color:#111">Student</span><span style="color:#f92672">&gt;</span> <span style="color:#75af00">getStudentsByStudnr</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">nr</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">saveNewStudent</span><span style="color:#111">(</span><span style="color:#111">Student</span> <span style="color:#111">student</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">updateStudent</span><span style="color:#111">(</span><span style="color:#111">Student</span> <span style="color:#111">student</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">public</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">deleteStudentByStudnr</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">nr</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><ol start="2">
<li>Hoe zou je bovenstaande <code>StudentRepository</code> unit (integratie) testen, zonder de &ldquo;productie database&rdquo; op te vullen met testdata? (Hint: kijk naar het constructor argument). Hoe kan je <code>getStudentsByName()</code> testen zonder de volgende oefening afgewerkt te hebben, die nieuwe studenten bewaren pas mogelijk maakt?</li>
<li>Breid dit uit met <code>saveNewStudent(Student)</code>.</li>
<li>Breid dit uit met <code>updateStudent(Student)</code>. Wat moet je doen als deze student nog niet in de database zit? Welke gegevens update je wel en welke niet?</li>
<li>Merk op dat elke keer als je je project opstart je geen <code>CREATE TABLE student</code> kan uitvoeren als je een file-based SQLite bestand hanteert: eens de tabel is aangemaakt geeft een nieuwe create foutmeldingen. <code>DROP TABLE IF EXISTS student;</code> lost dit op, maar daardoor ben je ook altijd je data kwijt. Hoe los je dit probleem op?</li>
<li>Stel dat een <code>Student</code> is ingeschreven in een <code>Cursus</code> met properties <code>naam</code> (vb. &ldquo;databases&rdquo;) en <code>ects</code> (vb. 4).
<ul>
<li>Maak een <code>CursusRepository</code> om nieuwe cursussen te bewaren.</li>
<li>Hoe link je de <code>Student</code> klasse met de <code>Cursus</code> klasse? wat verandert er in de query van <code>getStudentsByName()</code>?</li>
</ul>
</li>
</ol>
<p><strong>BELANGRIJK</strong>:</p>
<ul>
<li><code>executeUpdate()</code> van een <code>Statement</code> is erg omslachtig als je een string moet samenstellen die een <code>INSERT</code> query voorstelt (haakjes, enkele quotes, &hellip;). Wat meer is, als de input van een UI komt, kan dit gehacked worden, door zelf de quote te sluiten in de string. Dit noemt men <strong>SQL Injection</strong>, en om dat te vermijden gebruik je in JDBC de <code>prepareStatement()</code> methode. Zie <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html">JDBC Basics: Prepared Statements</a>. De String die je meegeeft bevat in de plaats van parameters een vraagteken: <code>INSERT INTO STUDENT(bla, bla) VALUES(?, ?)</code>. Die parameters vul je daarna aan met <code>preparedStatement.setString()</code> of <code>setInt()</code>. Op die manier is de code zowel <em>netjes</em> als <em>injectie-vrij</em>!</li>
<li>Als je data wenst op te halen dat is verspreid over verschillende tabellen, is de kans groot dat een <code>JOIN</code> SQL statement nodig is. Probeer eerst de query te schrijven in de <em>SQLite DB Browser</em> tool. De Java objecten opvullen is de laatste taak.</li>
</ul>
<p>Bijvoorbeeld:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#111">...</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">String</span> <span style="color:#111">stmt</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;INSERT INTO student(naam, voornaam, studnr, goedbezig) VALUES (?, ?, ?, ?)&#34;</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">System</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">.</span><span style="color:#75af00">println</span><span style="color:#111">(</span><span style="color:#111">stmt</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">PreparedStatement</span> <span style="color:#111">prepared</span> <span style="color:#f92672">=</span> <span style="color:#111">connection</span><span style="color:#111">.</span><span style="color:#75af00">prepareStatement</span><span style="color:#111">(</span><span style="color:#111">stmt</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">prepared</span><span style="color:#111">.</span><span style="color:#75af00">setString</span><span style="color:#111">(</span><span style="color:#111">1</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;Verboven&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">prepared</span><span style="color:#111">.</span><span style="color:#75af00">setString</span><span style="color:#111">(</span><span style="color:#111">2</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;Mark&#34;</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">prepared</span><span style="color:#111">.</span><span style="color:#75af00">setInt</span><span style="color:#111">(</span><span style="color:#111">3</span><span style="color:#111">,</span> <span style="color:#111">666</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">prepared</span><span style="color:#111">.</span><span style="color:#75af00">setBoolean</span><span style="color:#111">(</span><span style="color:#111">4</span><span style="color:#111">,</span> <span style="color:#00a8c8">false</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">prepared</span><span style="color:#111">.</span><span style="color:#75af00">execute</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">prepared</span><span style="color:#111">.</span><span style="color:#75af00">close</span><span style="color:#111">();</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span> <span style="color:#00a8c8">catch</span><span style="color:#111">(</span><span style="color:#111">SQLException</span> <span style="color:#111">ex</span><span style="color:#111">)</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">throw</span> <span style="color:#00a8c8">new</span> <span style="color:#111">RuntimeException</span><span style="color:#111">(</span><span style="color:#111">ex</span><span style="color:#111">);</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">...</span>
</span></span></code></pre></div><!-- ## Queries/Objecten in Jdbi 3

[Jdbi](https://jdbi.org) (Java DataBase Interface v3) is een lightweight library geschreven bovenop JDBC. Het gebruikt dus de interne Java API om te communiceren tussen de database en de Java applicatie. Echter, het maakt het leven voor ons als ontwikkelaar op heel wat vlakken véél _aangenamer_: waar JDBC eerder database-driven en dialect-afhankelijk is, is Jdbi eerder user-driven en met behulp van plugins dialect-onafhankelijk. 

JDBI3 is opgedeeld in modules, waarvan wij de volgende drie gaan gebruiken:

- `jdbi3-core` (altijd nodig) - voor JDBC zit dit in de JDK. 
- `jdbi3-sqlite` (voor de SQLite verbinding) - of andere DB driver
- `jdb3-sqlobject` - voor de eenvoudige mapping naar Plain Old Java Objects (POJOs)

```groovy
implementation group: 'org.jdbi', name: 'jdbi3-core', version: jdbiv
implementation group: 'org.jdbi', name: 'jdbi3-mysql', version: jdbiv
implementation group: 'org.jdbi', name: 'jdbi3-sqlobject', version: jdbiv
```

Met JDBI3 wordt op de volgende manier Java met de DB verbonden: -->
<div hidden>

<div class="mermaid" align="left" >
	
graph LR;
    Java[Java]
    Jdbi[Jdbi3-core]
    JDBC[JDBC]
    JMYSQL[Jdbi3-MySQL]
    MYSQL[MySQL-JDBC]
    DB[(MyuSQL Database)]
    subgraph Java space
    Java --> Jdbi
    Jdbi --> JDBC
    Jdbi --> JMYSQL
    JMYSQL -.-> MYSQL
    JDBC -.-> MYSQL
    end
    subgraph DB space
    MYSQL --> DB
    end

</div>
</div>
<!--
Er komt dus één blokje bij tussen Java en JDBC: we gebruiken niet langer de ingebouwde JDK interfaces maar rechtstreeks de `jdbi-core` dependency die via JDBC de MySQL connectie maakt. De `jdbi3-mysql` package is afhankelijk van `mysql-jdbc`: zie [artifact dependency info](https://mvnrepository.com/artifact/org.jdbi/jdbi3-mysql). Met andere worden, het wordt een _transitieve_ dependency: deze verdwijnt uit onze `build.gradle`, maar wordt nog steeds meegetrokken met de rest.

Er is ook support voor spring, jpa, guava, kotlin, ...

Om bovenstaande JDBC oefening te implementeren in Jdbi3 hebben we eerst een extractie van een interface nodig voor de repository acties:

```java
public interface StudentRepository {
    List<Student> getStudentsByName(String student);
    void saveNewStudent(Student student);
    void updateStudent(Student student);
}
```

Nu kan `StudentRepositoryJdbcImpl` (hernoem bovenstaande) en onze nieuwe `StudentRepositoryJdbi3Impl` de interface `implements`-en. Denk aan de **Strategy design pattern** van SES: afhankelijk van een instelling kunnen we switchen van SQL leverancier, zolang de code overal de interface gebruikt. 
-->
<div hidden>

<div class="mermaid" align="left" >
	
graph LR;
    Main[Controlller]
    Interface{StudentRepository}
    Jdbc[StudentRepositoryJdbcImpl]
    Jdbi[StudentRepositoryJdbi3Impl]
    Main --> Interface
    Interface --> Jdbc
    Interface --> Jdbi

</div>
</div>
<!--
### 1.2.1 JDBC vs Jdbi3

Geen idee waar te beginnen? Hier: http://jdbi.org/ 

#### **1. Connection openen**

In plaats van JDBC's `DriverManager.getConnection()` om de `Connection` instance te bootstrappen, gebruiken wij gewoon `Jdbi.create()` met ook één parameter, namelijk dezelfde ConnectionString. 

#### **2. Query uitvoeren**

In plaats van de vervelende checked `SQLException`s en de `createStatement()` code, heb je nu de keuze om ofwel de Fluent API te gebruiken:

```java
return jdbi.withHandle(handle -> {
   return handle.createQuery("SELECT * FROM student WHERE naam = :naam")
           .bind("naam", student)
           .mapToBean(Student.class)
           .list();
});
```

ofwel de Declarative API, waarbij je met de `@SqlQuery` kan werken op een interface:

```java
public interface StudentDao {
    @SqlQuery("SELECT * FROM student")
    @RegisterBeanMapper(Student.class)
    List<Student> getStudenten();
}
```

Dit vereist dat je de plugin `SqlObjectPlugin` installeert na de `Jdbi.create()`: `jdbi.installPlugin(new SqlObjectPlugin());`. Zie [jdbi.org](https://jdbi.org) documentatie.


<div class="notices note" ><p>Jdbi ondersteunt Kotlin met twee modules: <code>jdbi3-kotlin</code> en <code>jdbi3-kotlin-sqlobject</code> om data classes direct te binden aan een bepaalde tabel. Bovenstaande Java code (met <code>.bind()</code> werken) is analoog. Om verwarring te voorkomen zijn de Jdbi voorbeelden uitgewerkt in Java. Lees meer op <a href="http://jdbi.org/#_kotlin">http://jdbi.org/#_kotlin</a></p>
</div>



Herinner je je nog de **SESsy Library**? Die werkte ook op die manier! Kijk nog eens in https://github.com/kuleuven-diepenbeek/sessylibrary in de map `src.main.java.be.kuleuven.sessylibrary.domain` in klasse `BooksRepository`!

Merk op dat Jdbi3 er voor kan zorgen dat de resultaten van je query automatisch worden vertaald naar een `Student` instantie door middel van **bean mapping**: de `mapToBean()` methode of de `@RegisterBeanMapper` annotatie. Die gaat via reflectie alle kolomnamen 1-op-1 mappen op properties van je object dat je wenst te mappen. Er zijn ook nog andere mogelijkheden, zoals mappen op een `HashMap`, ea:

![](/img/jdbi-map.jpg)

#### **3. Transacties, insert/update queries, ...**

Zelfstudie. Zie [jdbi.org](https://jdbi.org) documentatie.

### 1.2.2 Oefeningen

**Quickstart project**: `examples/jdbc-repo-start` in in de [cursus repository](https://github.com/kuleuven-Diepenbeek/db-course) ([download repo zip](https://github.com/KULeuven-Diepenbeek/db-course/archive/refs/heads/main.zip)). Deze bevat reeds bovenstaande JDBC implementatie en een aantal unit testen, waarvan er nog twee falen.

1. Fix eerst de falende unit testen!
2. Herimplementeer alle methodes van de `StudentRepository` interface hierboven, maar dan in Jdbi3 met de Fluent API (`jdbi.withHandle()`). Maak een tweede klasse genaamd `StudentRepositoryJdbi3`. Schrijf ook een bijhorende unit test klasse (kijk voor inspiratie naar de JDBC implementatie). Om te testen of het werkt in "productie" kan je je testcode van JDBC herbruiken door de code de **interface** te laten gebruiken in plaats van de implementatie. Bijvoorbeeld:

<div class="devselect">

```kt
fun main(args: Array<String>) {
    val jdbcRepo = StudentRepositoryJdbc(...)
    val jdbiRepo = StudentRepositoryJdbi3(...)
    doStuff(jdbcRepo)
}
fun doStuff(repository: StudentRepository) {
    // argunent = interface!
    // uw repository.getStudentsByName, saveNewStudent, ... tests hier
}
```

```java
public class OefeningMain {
        public static void main(String[] args) {
            var jdbcRepo = new StudentRepositoryJdbc(...);
            var jdbiRepo = new StudentRepositoryJdbi3(...);
            doStuff(jdbcRepo);
        }
        public static void doStuff(StudentRepository repository) {
            // argunent = interface!
            // uw repository.getStudentsByName, saveNewStudent, ... tests hier
        }
}
```
</div>

3. Implementeer opnieuw de `Cursus` link met de `Student`. Is het schrijven van `JOIN` queries in Jdbi3 eenvoudiger?
4. _Extra Oefening_: Maak een nieuwe implementatie van de repository interface die via de Jdbi3 Declaratie API de queries doorgeeft naar de SQLite DB. D.w.z., lees in de [Jdbi3 developer guide](http://jdbi.org/#_declarative_api) na hoe je de Declarative API gebruikt en verwerk dit. Tip: `jdbi.withExtension(StudentDao.class, ...)`. 

**Tip**:

- Neem de tijd om de JDBI documentatie uitvoerig te bekijken!

## 1.3 Jdbi Backend + JavaFX Frontend

Met Java database access enigszins onder de knie kijken we verder dan alleen maar de "repository". Op welke manier kunnen we onze `STUDENT` tabel visueel weergeven, en er studenten aan toevoegen of uit verwijderen? 

Dat kan op verschillende manieren, van HTML (SESsy Library) en JavaScript API calls naar iets eenvoudiger vanuit het eerstejaarsvak INF1: **JavaFX**. Je kan in JavaFX eenvoudig `TableView` stukken positioneren op een `AnchorPane` en die vullen met de juiste kolommen en rijen. De data blijft uiteraard uit de SQLite DB komen via JDBC/Jdbi. De `StudentRepository` is dus slechts één deel van het verhaal: waar wordt deze gebruikt? In JavaFX controllers. 

### 1.3.1 Een Gradle JavaFX Project

Er zijn een aantal aanpassingen nodig aan je `build.gradle` file om van een gewone Java applicatie over te schakelen naar een JavaFX-enabled applicatie. We hebben de **application** en **javafxplugin** plugins nodig onder `plugins {}`, verder ook een `javafx {}` property groep die bepaalt welke modules van JavaFX worden ingeladen:

```
plugins {
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.0.13'
}

repositories {
    mavenCentral()
}

javafx {
    version = "17"
    modules = [ 'javafx.controls', 'javafx.fxml' ]
}

dependencies {
    implementation group: 'org.xerial', name: 'sqlite-jdbc', version: '3.43.2.0'
    implementation group: 'org.jdbi', name: 'jdbi3-core', version: '3.41.3'
    implementation group: 'org.jdbi', name: 'jdbi3-sqlite', version: '3.41.3'
    implementation group: 'org.jdbi', name: 'jdbi3-sqlobject', version: '3.41.3'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine'    
}

group 'be.kuleuven.javasql'
version '1.0-SNAPSHOT'
sourceCompatibility = 1.13
mainClassName = 'be.kuleuven.javasql.SqlFxMain'

jar {
    manifest {
        attributes 'Implementation-Title': project.getProperty('name'),
                'Implementation-Version': project.getProperty('version'),
                'Main-Class': project.getProperty('mainClassName')
    }
}
```

Herinner je het volgende over JavaFX:

- De main klasse leidt af van `Application` en laadt de hoofd-`.fxml` file in.
- Controllers hebben een `public void initialize()` methode waar action binding in wordt gedefinieerd. 
- `.fxml` files beheer je met SceneBuilder. Vergeet hier niet de link naar de fully qualified name van je controller klasse te plaatsen als `AnchorPane` attribuut: `fx:controller="be.kuleuven.javasql.controller.StudentController"`.


<div class="notices warning" ><p>Problemen met je JDK versie en Gradle versies? Raadpleeg de <a href="https://docs.gradle.org/current/userguide/compatibility.html">Gradle Compatibiility Matrix</a>. Gradle 6.7 of hoger ondersteunt JDK15. Gradle 7.3 of hoger ondersteunt JDK17. Let op met syntax wijzigingen bij Gradle 7+!<br/>
Je Gradle versie verhogen kan door de URL in <code>gradle/gradlew.properties</code> te wijzigen.<br/>
De laatste versie van JavaFX is 17&mdash;backwards compatible met JDK15 en hoger.</p>
</div>


Voor onze studententabel visualisatie hebben we een `TableView` nodig. Daarnaast eventueel `Button`s om te editeren/toe te voegen/... Vergeet de `fx:id` van de tabel niet:

![](/img/javafx-id.jpg)

Kolommen (en de inhoud van de rijen) definiëren we in de controller zelf:

<div class="devselect">

```kt
@FXML
private lateinit var tblStudent: TableView<Student>

fun initialize() {
    tblStudent.getColumns().clear()
    val col: TableColumn<Student, String> = TableColumn<>("Naam").apply {
        setCellValueFactory(f -> ReadOnlyObjectWrapper<>(f.getValue().getMaam()))
    }
    with(tblStudent) {
        getColumns().add(col)
        getItems().add(Student("Joske", "Josmans", 124, true))
    }
}
```

```java
@FXML
private TableView<Student> tblStudent;

public void initialize() {
    tblStudent.getColumns().clear();
    TableColumn<Student, String> col = new TableColumn<>("Naam");
    col.setCellValueFactory(f -> new ReadOnlyObjectWrapper<>(f.getValue().getMaam()));
    tblStudent.getColumns().add(col);
    
    tblStudent.getItems().add(new Student("Joske", "Josmans", 124, true));
}
```
</div>

Merk op dat `TableView` een generisch type heeft, en we zo dus heel eenvoudig onze eigen POJO rechtstreeks kunnen mappen op de `Student` klasse! Als we dit opstarten krijgen we alvast één kolom te zien met de naam (`f` in de `CellValueFactory` is een wrapper waarvan de waarde de huidige student in de rij is. `getNaam()` zorgt ervoor dat de juiste waarde in de juiste cel komt te staan)

![](/img/fxmltable.jpg)

### 1.3.2 Oefeningen

**Quickstart project**: `examples/jdbc-fxml-start` in de [cursus repository](https://github.com/kuleuven-Diepenbeek/db-course) ([download repo zip](https://github.com/KULeuven-Diepenbeek/db-course/archive/refs/heads/main.zip)). Deze bevat reeds bovenstaande JDBC implementatie en een leeg gekoppeld JavaFx project. Om uit te voeren, klik op "Gradle" en voer target "run" uit (dus niet op "Play" in de main klasse!).

1. Werk bovenstaande voorbeeld verder uit voor alle kolommen. Voeg eerst testdata toe (`getItems().add(new student...`).
2. Probeer nu de controller te linken met de repository. De tabel items moeten overeenkomen met de repository items. Proficiat, je kijkt naar "live data"!
3. Voeg een knop **Voeg Toe** toe op het scherm, dat een ander FXML venster opent, waar je gegevens van de nieuwe student kan ingeven, en kan bewaren. De "bewaren" knop persisteert naar de database, sluit het venster, én refresht het studentenadmin overzichtsscherm. 

**Tip**: Vanuit een JavaFX controller een ander scherm openen is een kwestie van een nieuwe `Stage` en `Scene` object aan te maken:

<div class="devselect">

```kt
private fun showScherm() {
    val resourceName = "bla.fxml"
    val root = FXMLLoader.load(this::class.java..getResource(resourceName)) as AnchorPane;
    val stage = Stage().apply {
        setScene(Scene(root))
        setTitle("dinges")
        initModality(Modality.WINDOW_MODAL)
        show()
    }
}
```

```java
private void showScherm() {
    var resourceName = "bla.fxml";
    try {
        var stage = new Stage();
        var root = (AnchorPane) FXMLLoader.load(getClass().getClassLoader().getResource(resourceName));
        stage.setScene(new Scene(root));
        stage.setTitle("dinges");
        stage.initModality(Modality.WINDOW_MODAL);
        stage.show();

    } catch (Exception e) {
        throw new RuntimeException(e);
    }
}
```
</div>

Zit je vast? Raadpleeg de **TableView JavaDocs**: https://openjfx.io/javadoc/13/javafx.controls/javafx/scene/control/TableView.html

Bekijk een voorbeeld **Kotlin/JavaFX project** in de [github appdev-course repository](https://github.com/KULeuven-Diepenbeek/appdev-course/tree/main/examples/kotlin/walkerfx/src/main/kotlin/be/kuleuven/walkerfx). -->
</article>

<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../apis/basics/" title="API Basics"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../transacties/" title="RDBMS Transacties" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1742303804"></script>
    <script src="../../js/perfect-scrollbar.min.js?1742303804"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1742303804"></script>
    <script src="../../js/jquery.sticky.js?1742303804"></script>
    <script src="../../js/featherlight.min.js?1742303804"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1742303804"></script>
    <script src="../../js/learn.js?1742303804"></script>
    <script src="../../js/hugo-learn.js?1742303804"></script>
    <script src="../../js/mermaid.min.js?1742303804"></script>
    <script>
    window.MathJax = {
      chtml: {
        scale: 1,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

