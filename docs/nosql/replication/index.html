<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>5. Replication :: Databases</title>

    
    <link href="../../css/nucleus.css?1669983633" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1669983633" rel="stylesheet">
    <link href="../../css/hybrid.css?1669983633" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1669983633" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1669983633" rel="stylesheet">
    <link href="../../css/auto-complete.css?1669983633" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1669983633" rel="stylesheet">
    <link href="../../css/theme.css?1669983633" rel="stylesheet">
    <link href="../../css/devselector.css?1669983633" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1669983633" rel="stylesheet">
    <link href="../../css/theme-kul.css?1669983633" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1669983633"></script>
    <script src="../../js/devselector.js?1669983633"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../../nosql/replication/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1669983633"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1669983633"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/db-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1669983633"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/sql/" title="1. RDBMS" class="dd-item
        
        
        
        ">
      <a href="../../sql/">
          1. RDBMS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-basics/" title="1. Database Basics" class="dd-item ">
        <a href="../../sql/rdbms-basics/">
        1. Database Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-components/" title="2. Database Componenten" class="dd-item ">
        <a href="../../sql/rdbms-components/">
        2. Database Componenten
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-acid/" title="3. ACID" class="dd-item ">
        <a href="../../sql/rdbms-acid/">
        3. ACID
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/sql-ddl-dml/" title="2. SQL DDL &amp; DML" class="dd-item
        
        
        
        ">
      <a href="../../sql-ddl-dml/">
          2. SQL DDL &amp; DML
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/ddl/" title="1. DDL" class="dd-item ">
        <a href="../../sql-ddl-dml/ddl/">
        1. DDL
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/dml/" title="2. DML" class="dd-item ">
        <a href="../../sql-ddl-dml/dml/">
        2. DML
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/transacties/" title="3. RDBMS Transacties" class="dd-item
        
        
        
        ">
      <a href="../../transacties/">
          3. RDBMS Transacties
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/transacties/basics/" title="1. Transaction Mgmt. Basics" class="dd-item ">
        <a href="../../transacties/basics/">
        1. Transaction Mgmt. Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/concurrency-control/" title="2. Concurrency Control" class="dd-item ">
        <a href="../../transacties/concurrency-control/">
        2. Concurrency Control
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/failures-rollbacks/" title="3. Failures-Rollbacks" class="dd-item ">
        <a href="../../transacties/failures-rollbacks/">
        3. Failures-Rollbacks
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/concurrency-in-practice/" title="4. Concurrency in de Praktijk" class="dd-item ">
        <a href="../../transacties/concurrency-in-practice/">
        4. Concurrency in de Praktijk
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/apis/" title="4. Database APIs" class="dd-item
        
        
        
        ">
      <a href="../../apis/">
          4. Database APIs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/apis/basics/" title="1. API Basics" class="dd-item ">
        <a href="../../apis/basics/">
        1. API Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jdbc-jdbi/" title="2. JDBC en JDBI" class="dd-item ">
        <a href="../../apis/jdbc-jdbi/">
        2. JDBC en JDBI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jpa/" title="3. JPA en Hibernate" class="dd-item ">
        <a href="../../apis/jpa/">
        3. JPA en Hibernate
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/extra-oefeningen/" title="4. Extra Oefeningen" class="dd-item ">
        <a href="../../apis/extra-oefeningen/">
        4. Extra Oefeningen
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/nosql/" title="5. NoSQL" class="dd-item
        parent
        
        
        ">
      <a href="../../nosql/">
          5. NoSQL
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/nosql/basics/" title="1. NoSQL Basics" class="dd-item ">
        <a href="../../nosql/basics/">
        1. NoSQL Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/keyvaluestores/" title="2. Key-value stores" class="dd-item ">
        <a href="../../nosql/keyvaluestores/">
        2. Key-value stores
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/documentstores/" title="3. Document stores" class="dd-item ">
        <a href="../../nosql/documentstores/">
        3. Document stores
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/mapreduce/" title="4. Advanced map-red. queries" class="dd-item ">
        <a href="../../nosql/mapreduce/">
        4. Advanced map-red. queries
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/replication/" title="5. Replication" class="dd-item active">
        <a href="../../nosql/replication/">
        5. Replication
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/xml/" title="6. XML Data Storage" class="dd-item
        
        
        
        ">
      <a href="../../xml/">
          6. XML Data Storage
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bigdata/" title="7. Big Data &amp; Analytics" class="dd-item
        
        
        
        ">
      <a href="../../bigdata/">
          7. Big Data &amp; Analytics
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/bigdata/datawarehousing/" title="1. Data Warehousing &amp; BI" class="dd-item ">
        <a href="../../bigdata/datawarehousing/">
        1. Data Warehousing &amp; BI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata/hadoop/" title="2. Big Data &amp; Hadoop" class="dd-item ">
        <a href="../../bigdata/hadoop/">
        2. Big Data &amp; Hadoop
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/extra/" title="X. Extras" class="dd-item
        
        
        
        ">
      <a href="../../extra/">
          X. Extras
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/extra/software/" title="Gebruikte Software" class="dd-item ">
        <a href="../../extra/software/">
        Gebruikte Software
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/extra/project/" title="Project opdracht" class="dd-item ">
        <a href="../../extra/project/">
        Project opdracht
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2022&amp;i=4290&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://toledo.kuleuven.be/portal/"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/kuleuven-diepenbeek/db-course/"><i class='fab fa-github'></i> Course Git Repository</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Index</a> > <a href='../../nosql/'>5. NoSQL</a> > 5. Replication
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#replication-opzetten">Replication opzetten</a></li>
        <li><a href="#demo-js-code">Demo JS code</a></li>
        <li><a href="#oefeningen">Oefeningen</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
        <li><a href="#denkvragen">Denkvragen</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              5. Replication
            </h1>
          

        


<p><figure>
	<a href="../../img/pouchdb.jpg" data-featherlight="image">
		<img src="../../img/pouchdb.jpg"  >
	</a>
	
</figure>
</p>
<p>Met <em>replication</em> is het eenvoudig om clusters van clones te maken om de 99.9% uptime te kunnen garanderen, gegeven de juiste loadbalancing instellingen. Als voorbeeld gaan we een open-source JavaScript DB gebruiken genaamd <a href="https://pouchdb.com">PouchDB</a>. PouchDB draait goed client-side in de browser, en interfacet heel gemakkelijk met zijn inspirator, CouchDB. Met Pouch is het een kwestie van een paar regeltjes code om replication aan te zetten tussen Pouch en de &ldquo;master&rdquo; Couch database, zoals ook zichtbaar op de Pouch website:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">var</span> <span style="color:#75af00">db</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#75af00">PouchDB</span><span style="color:#111">(</span><span style="color:#d88200">&#39;dbname&#39;</span><span style="color:#111">);</span>

<span style="color:#75af00">db</span><span style="color:#111">.</span><span style="color:#75af00">put</span><span style="color:#111">({</span>
  <span style="color:#75af00">_id</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#39;dave@gmail.com&#39;</span><span style="color:#111">,</span>
  <span style="color:#75af00">name</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#39;David&#39;</span><span style="color:#111">,</span>
  <span style="color:#75af00">age</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">69</span>
<span style="color:#111">});</span>

<span style="color:#75af00">db</span><span style="color:#111">.</span><span style="color:#75af00">changes</span><span style="color:#111">().</span><span style="color:#75af00">on</span><span style="color:#111">(</span><span style="color:#d88200">&#39;change&#39;</span><span style="color:#111">,</span> <span style="color:#00a8c8">function</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">console</span><span style="color:#111">.</span><span style="color:#75af00">log</span><span style="color:#111">(</span><span style="color:#d88200">&#39;Ch-Ch-Changes&#39;</span><span style="color:#111">);</span>
<span style="color:#111">});</span>

<span style="color:#75af00">db</span><span style="color:#111">.</span><span style="color:#75af00">replicate</span><span style="color:#111">.</span><span style="color:#75af00">to</span><span style="color:#111">(</span><span style="color:#d88200">&#39;http://example.com/mydb&#39;</span><span style="color:#111">);</span>
</code></pre></div><h3 id="replication-opzetten">Replication opzetten</h3>
<p>Wat is <strong>het doel</strong>? Replication op te zetten tussen de cursussen database van <a href="../../nosql/documentstores">2. document stores</a> en de PouchDB JS web-based client. Dat kan op verschillende manieren:</p>
<ol>
<li><strong>Unidirectional</strong> replication&mdash;1-way traffic master/slave. Eén database is de &ldquo;master&rdquo; waar men op werkt, en de andere is een mirror/backup.</li>
<li><strong>Bidirectional</strong> replication&mdash;2-way traffic. Data die in beide databases verandert, wordt gesynchroniseerd naar beiden databases. Uiteraard zul je hier aan conflict management moeten doen.</li>
<li><strong>Live/Continuous</strong> replication&mdash;2-way &ldquo;live&rdquo; traffic dat onmiddellijk zichtbaar is via JS callbacks.</li>
</ol>
<p><figure>
	<a href="../../slides/img/offline_replication.gif" data-featherlight="image">
		<img src="../../slides/img/offline_replication.gif"   title="Offline replication schematisch voorgesteld. src: pouchdb.com">
	</a>
	
		<figcaption>Offline replication schematisch voorgesteld. src: pouchdb.com</figcaption>
	
</figure>
</p>
<p>Zie ook de <a href="https://pouchdb.com/guides/replication.html">PouchDB Docs: replication explained</a>. Merk op dat de drie bovenstaande replication principes ook van toepassing zijn voor CouchDB. Om replication te demonstreren hebben we uiteraard een 2de database nodig, vandaar de introductie van PouchDB.</p>
<h4 id="interne-werking">Interne werking</h4>
<p>Hoe werkt replication intern? Elk document heeft een <code>_rev</code> property:</p>
<p><figure>
	<a href="../../slides/img/revs.jpg" data-featherlight="image">
		<img src="../../slides/img/revs.jpg"  >
	</a>
	
</figure>
</p>
<p>Elke change aan elk document wordt bijgehouden. In bovenstaande screenshot zie je als eerste document een <code>_rev</code> value van <code>3-82ac8d...</code>. Dit is <strong>revisie 3</strong>. Je kan deze lijst van revisies van één bepaald document ook raadplegen via een REST: zie de documentatie, <a href="https://docs.couchdb.org/en/stable/api/document/common.html#getting-a-list-of-revisions">GET list of revisions</a>.</p>
<p>Een document ophalen in CouchDB kan via <code>http://127.0.0.1:5984/[db]/[key]</code>. Voeg aan deze url <code>?revs=true</code> of <code>?revs_info=true</code> toe en kijk wat er gebeurt.</p>
<h3 id="demo-js-code">Demo JS code</h3>
<p>Je kan bovenstaande demo code onmiddellijk proberen op <a href="https://pouchdb.com">https://pouchdb.com</a>: Druk op <code>F12</code> of <code>CTRL+SHIFT+J</code> (Mac: <code>OPT+CMD+J</code>) of ga naar menu Developer -&gt; Developer Tools van je favoriete browser. In de tab &ldquo;Console&rdquo; wordt je begroet door de PouchDB welkomsttekst. Daar kan je je test commando&rsquo;s in uitvoeren: <code>var db = ...</code>. Om te controleren of het record het tot in de database heeft gehaald, zie hieronder, bij tips.</p>
<p>Gebruik in de oefeningen de CDN versie om het jezelf gemakkelijk te maken. Maak een leeg <code>.html</code> bestand aan en kopieer de Quick Start code over:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;//cdn.jsdelivr.net/npm/pouchdb@7.2.1/dist/pouchdb.min.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
<span style="color:#111">&lt;</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">db</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#75af00">PouchDB</span><span style="color:#111">(</span><span style="color:#d88200">&#39;my_database&#39;</span><span style="color:#111">);</span>
<span style="color:#111">&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</code></pre></div><p>Vergeet niet dat je lokale CouchDB waarschijnlijk draait op poort <code>5984</code>.</p>

<div class="notices note" ><p>PouchDB, CouchDB, help, wat is het verschil? Pouch is een <strong>JavaScript client</strong> library voor Node en het Web. Beiden gebruiken Mango, MapReduce Replication, &hellip; technieken. Beiden kan je clusteren, hebben conflict management, compacting, &hellip; Bekijk het zo: Pouch is de (easy-to-setup) Couch van het web. Zie ook: <a href="https://pouchdb.com/users.html">Who&rsquo;s using PouchDB?</a></p>
</div>

<p>Een uitgewerkt voorbeeld in begeleidende video:</p>
<div style="position: relative; padding-bottom: 62.5%; height: 0;"><iframe src="https://www.loom.com/embed/fa612f2efe424da68d3d9aeb362ed5f1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe></div>
<h3 id="oefeningen">Oefeningen</h3>
<ol>
<li>Start CouchDB opnieuw met de bestaande courses db. Stel PouchDB in op unidirectionele replication. Alle LOKALE wijzigingen worden nu bewaard in de remote DB. Schrijf in Javascript ter test een nieuw fictief document weg met <code>db.put()</code>. Vul alle JSON properties in: kijk naar een bestaand document in je Couch database.</li>
<li>Maak een nieuw <code>.html</code> bestand aan, en stel een <a href="https://pouchdb.com/guides/databases.html">remote URL</a> in om vanuit JS onmiddellijk op de remote DB te kunnen queryen.
<ul>
<li>Gebruik de <a href="https://pouchdb.com/guides/mango-queries.html">Mango query API</a> van Pouch om in CouchDB de oefeningen van <a href="../../nosql/documentstores">2. document stores</a> te implementeren. Opgelet: hier moet je een extra JS file voor includen, <code>pouchdb.find.js</code>, zoals aangegeven in de link, <a href="https://github.com/pouchdb/pouchdb/releases/">downloadbaar hier</a> en zorg ervoor dat zowel PouchDB als de find versies van dezelfde release komen!</li>
<li>Gebruik de <a href="https://pouchdb.com/guides/queries.html">Mapreduce query API</a> van Pouch om in CouchDB de oefeningen van <a href="../../nosql/mapreduce">3. advanced map/red. queries</a> te implementeren. Merk op dat voor map <strong>en</strong> reduce beiden uit te voeren, je een JSON object moet meegeven met beide functies: <code>{ map: function(doc) { emit(...); }, reduce: '_count}</code>. Zie docs in link.</li>
</ul>
</li>
<li>Maak een nieuw <code>.html</code> bestand aan, en stel continuous replication in. Voeg dan een nieuw document toe in de CouchDB Admin console. Maak in HTML een knop die gewoon records afdrukt via <code>console.log()</code>. Wordt het nieuwe document getoond? Gebruik deze boilerplate:</li>
</ol>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;https://cdn.jsdelivr.net/npm/pouchdb@7.2.1/dist/pouchdb.min.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
<span style="color:#111">&lt;</span><span style="color:#f92672">button</span> <span style="color:#75af00">id</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;btn&#34;</span><span style="color:#111">&gt;</span>Print docs<span style="color:#111">&lt;/</span><span style="color:#f92672">button</span><span style="color:#111">&gt;</span>
<span style="color:#111">&lt;</span><span style="color:#f92672">pre</span> <span style="color:#75af00">id</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;pre&#34;</span><span style="color:#111">&gt;</span>
...
<span style="color:#111">&lt;/</span><span style="color:#f92672">pre</span><span style="color:#111">&gt;</span>
<span style="color:#111">&lt;</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
<span style="color:#00a8c8">function</span> <span style="color:#75af00">print</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#111">document</span><span style="color:#111">.</span><span style="color:#75af00">querySelector</span><span style="color:#111">(</span><span style="color:#d88200">&#39;#pre&#39;</span><span style="color:#111">).</span><span style="color:#75af00">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#75af00">JSON</span><span style="color:#111">.</span><span style="color:#75af00">stringify</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">);</span>
<span style="color:#111">}</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">db</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#75af00">PouchDB</span><span style="color:#111">(</span><span style="color:#d88200">&#39;my_database&#39;</span><span style="color:#111">);</span>
  <span style="color:#75715e">// do your setup here
</span><span style="color:#75715e"></span>
  <span style="color:#00a8c8">function</span> <span style="color:#75af00">queryDocs</span><span style="color:#111">()</span> <span style="color:#111">{</span>
     <span style="color:#75715e">// do your thing here
</span><span style="color:#75715e"></span>     <span style="color:#75af00">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;goed bezig&#39;</span><span style="color:#111">);</span>
  <span style="color:#111">}</span>

<span style="color:#111">document</span><span style="color:#111">.</span><span style="color:#75af00">querySelector</span><span style="color:#111">(</span><span style="color:#d88200">&#34;#btn&#34;</span><span style="color:#111">).</span><span style="color:#75af00">addEventListener</span><span style="color:#111">(</span><span style="color:#d88200">&#34;click&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">queryDocs</span><span style="color:#111">);</span>
<span style="color:#111">&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</code></pre></div><p><strong>Tips</strong>: Wanneer je een item hebt toegevoegd aan je lokale JavaScript database met <code>.put()</code>, maar replication <em>nog niet</em> aan staat, kan het handig zijn om met Chrome/Opera/&hellip; Dev Tools te kijken naar de <strong>local storage</strong> databases. Deze zijn terug te vinden in de tab &ldquo;Application&rdquo;, bij &ldquo;IndexedDB&rdquo;:</p>
<p><figure>
	<a href="../../img/localstorage.jpg" data-featherlight="image">
		<img src="../../img/localstorage.jpg"  >
	</a>
	
</figure>
</p>
<p>De volgende elementen zijn te herkennen in bovenstaande screenshot:</p>
<ul>
<li>Ik heb een &ldquo;<code>mydb</code>&rdquo; object aangemaakt (DB naam <code>_pouch_mydb</code>)</li>
<li>Onder element &ldquo;<code>by-sequence</code>&rdquo; kan je de huidige elementen in de DB raadplegen, zoals bovenstaande demo code waarbij object met naam &ldquo;David&rdquo; werd toegevoegd.</li>
</ul>
<h3 id="troubleshooting">Troubleshooting</h3>
<p><strong>Cross site origin fouten?</strong> - Het kan zijn dat je browser, zoals een strict ingestelde Firefox, klaagt over Cross-Origin domains wanneer replication aan staat, omdat die naar <code>127.0.0.1</code> gaat, en je browser de <code>.html</code> file aanlevert vanuit <code>file:///</code> wat technisch gezien niet dezelfde hostname is. Ga naar je CouchDB <a href="http://127.0.0.1:5984/_utils/#_config/couchdb@localhost/cors">admin config</a> (klik op tandwieltje), op <strong>CORS</strong>, en klik <em>&ldquo;enable&rdquo; (all domains)</em>.  Oplossing 1: gebruik een andere browser. Oplossing 2: disable CORS <a href="https://dev.to/andypotts/avoiding-cors-errors-on-localhost-in-2020-4mfn">in de browser</a> (zie artiel). Optie 3: gebruik een python3 webserver om je bestand te serven. Open een terminal en typ <code>python -m http.server</code> in de directory van je html bestand. Ga dan naar http://127.0.0.1:8000/oefening.html (Poort <code>8000</code>). Indien niet opgelost, ga naar volgende troubleshooting puntje:</p>
<p><strong>Connecton errors?</strong> - Als Pouch bij replication connection errors geeft in de JS Console kan het zijn dat je Couch server te streng staat ingesteld, en hij de requests blokkeert. In dat geval ga je naar Fauxton, klik je op het &ldquo;tandwieltje&rdquo; linkqs, en enable je <code>CORS</code> (Cross Origin Requests):</p>
<p><figure>
	<a href="../../img/cors.png" data-featherlight="image">
		<img src="../../img/cors.png"  >
	</a>
	
</figure>
</p>
<p><strong>Access denied?</strong> - Als je een admin username/password hebt ingesteld dien je dit ook mee te geven met de parameters: <code>new PouchDb(&quot;http://localhost:5984&quot;, { auth: { username: &quot;jef&quot;, password: &quot;lowie&quot;} })</code>. Zie <a href="https://pouchdb.com/api.html#create_database">options for remote databases</a> in de PouchDb API manual.</p>
<p><strong>Mijn <code>find()</code> doet niks</strong>? - Merk op dat eender welke actie een <code>Promise</code> object teruggeeft. Dat wil zeggen dat de query &ldquo;onderweg&rdquo; is, en als je iets wilt uitvoeren wanneer dit klaar is (een <em>asynchroon</em> proces), moet dit via de <code>Promise</code> API, zoals <code>.then()</code>. Lees hierover in de <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">Mozilla MDN docs</a>.</p>
<p><strong>Ik krijg rare javascript errors?</strong> - Is je <code>pouch.min.js</code> en <code>pouch.find.min.js</code> versie dezelfde? D.w.z. zijn de major/minor/revision nummers hetzelfde? Dit staat aangeduid in de eerste regel van de source file. Indien niet, download de correcte versie via de PouchDB <a href="https://github.com/pouchdb/pouchdb/releases/">Github Releases pagina</a>.</p>
<p><strong>Ik krijg 404 object not found bij put?</strong> - Heb je je remote DB opgezet naar een onbestaande database, zoals <code>/hallokes</code>? Die moet je eerst <em>zelf aanmaken</em> in de CouchDB admin pagina! Anders kan je geen <code>PUT</code> commando&rsquo;s op die URL opsturen.</p>
<p><strong>Uncaught in Promise request PUT not supported?</strong> - In <code>serviceWorker.js</code>? Ben je op de pouchdb.com website in de console dingen aan het testen? Sommige scripts, zoals deze, vangen <code>PUT</code> commando&rsquo;s op en crashen dan. Je object zal wel correct zijn bewaard, dit mag je negeren.</p>
<h3 id="denkvragen">Denkvragen</h3>
<ul>
<li>Heb je een verschil gemerkt tussen bidirectionele en live replication in PouchDB? Probeer beide instellingen uit en kijk in de Chrome/Opera/Mozilla Dev Tools van je browser naar de uitgaande HTTP requests. Op welk moment gebeurt dit? Welke <code>POST</code>/<code>GET</code> metadata wordt verstuurd?</li>
<li>Wat is het verschil tussen in Pouch alle documenten op te vragen en daarna als array MapReduces toe te passen, of dit in de Mango query rechtstreeks te doen?</li>
</ul>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../nosql/mapreduce/" title="4. Advanced map-red. queries"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../xml/" title="6. XML Data Storage" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1669983633"></script>
    <script src="../../js/perfect-scrollbar.min.js?1669983633"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1669983633"></script>
    <script src="../../js/jquery.sticky.js?1669983633"></script>
    <script src="../../js/featherlight.min.js?1669983633"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1669983633"></script>
    <script src="../../js/learn.js?1669983633"></script>
    <script src="../../js/hugo-learn.js?1669983633"></script>
    <script src="../../js/mermaid.min.js?1669983633"></script>
    <script>
    window.MathJax = {
      chtml: {
        scale: 2,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

