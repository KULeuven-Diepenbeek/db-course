<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>4. Advanced map-red. queries :: Databases</title>

    
    <link href="../../css/nucleus.css?1697097250" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1697097250" rel="stylesheet">
    <link href="../../css/hybrid.css?1697097250" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1697097250" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1697097250" rel="stylesheet">
    <link href="../../css/auto-complete.css?1697097250" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1697097250" rel="stylesheet">
    <link href="../../css/theme.css?1697097250" rel="stylesheet">
    <link href="../../css/devselector.css?1697097250" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1697097250" rel="stylesheet">
    <link href="../../css/theme-kul.css?1697097250" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1697097250"></script>
    <script src="../../js/devselector.js?1697097250"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../../nosql/mapreduce/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1697097250"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1697097250"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/db-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1697097250"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/sql/" title="1. RDBMS" class="dd-item
        
        
        
        ">
      <a href="../../sql/">
          1. RDBMS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-basics/" title="1. Database Basics" class="dd-item ">
        <a href="../../sql/rdbms-basics/">
        1. Database Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-components/" title="2. Database Componenten" class="dd-item ">
        <a href="../../sql/rdbms-components/">
        2. Database Componenten
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql/rdbms-acid/" title="3. ACID" class="dd-item ">
        <a href="../../sql/rdbms-acid/">
        3. ACID
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/sql-ddl-dml/" title="2. SQL DDL &amp; DML" class="dd-item
        
        
        
        ">
      <a href="../../sql-ddl-dml/">
          2. SQL DDL &amp; DML
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/ddl/" title="1. DDL" class="dd-item ">
        <a href="../../sql-ddl-dml/ddl/">
        1. DDL
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sql-ddl-dml/dml/" title="2. DML" class="dd-item ">
        <a href="../../sql-ddl-dml/dml/">
        2. DML
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/transacties/" title="3. RDBMS Transacties" class="dd-item
        
        
        
        ">
      <a href="../../transacties/">
          3. RDBMS Transacties
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/transacties/basics/" title="1. Transaction Mgmt. Basics" class="dd-item ">
        <a href="../../transacties/basics/">
        1. Transaction Mgmt. Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/concurrency-control/" title="2. Concurrency Control" class="dd-item ">
        <a href="../../transacties/concurrency-control/">
        2. Concurrency Control
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/failures-rollbacks/" title="3. Failures-Rollbacks" class="dd-item ">
        <a href="../../transacties/failures-rollbacks/">
        3. Failures-Rollbacks
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/transacties/concurrency-in-practice/" title="4. Concurrency in de Praktijk" class="dd-item ">
        <a href="../../transacties/concurrency-in-practice/">
        4. Concurrency in de Praktijk
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/apis/" title="4. Database APIs" class="dd-item
        
        
        
        ">
      <a href="../../apis/">
          4. Database APIs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/apis/basics/" title="1. API Basics" class="dd-item ">
        <a href="../../apis/basics/">
        1. API Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jdbc-jdbi/" title="2. JDBC en JDBI" class="dd-item ">
        <a href="../../apis/jdbc-jdbi/">
        2. JDBC en JDBI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/jpa/" title="3. JPA en Hibernate" class="dd-item ">
        <a href="../../apis/jpa/">
        3. JPA en Hibernate
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/apis/extra-oefeningen/" title="4. Extra Oefeningen" class="dd-item ">
        <a href="../../apis/extra-oefeningen/">
        4. Extra Oefeningen
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/nosql/" title="5. NoSQL" class="dd-item
        parent
        
        
        ">
      <a href="../../nosql/">
          5. NoSQL
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/nosql/basics/" title="1. NoSQL Basics" class="dd-item ">
        <a href="../../nosql/basics/">
        1. NoSQL Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/keyvaluestores/" title="2. Key-value stores" class="dd-item ">
        <a href="../../nosql/keyvaluestores/">
        2. Key-value stores
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/documentstores/" title="3. Document stores" class="dd-item ">
        <a href="../../nosql/documentstores/">
        3. Document stores
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/mapreduce/" title="4. Advanced map-red. queries" class="dd-item active">
        <a href="../../nosql/mapreduce/">
        4. Advanced map-red. queries
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/nosql/replication/" title="5. Replication" class="dd-item ">
        <a href="../../nosql/replication/">
        5. Replication
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/xml/" title="6. XML Data Storage" class="dd-item
        
        
        
        ">
      <a href="../../xml/">
          6. XML Data Storage
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/xml/basics/" title="1. XML Basics" class="dd-item ">
        <a href="../../xml/basics/">
        1. XML Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/xml/xsd/" title="2. XSD" class="dd-item ">
        <a href="../../xml/xsd/">
        2. XSD
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/xml/xpath/" title="3. XPath" class="dd-item ">
        <a href="../../xml/xpath/">
        3. XPath
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bigdata/" title="7. Big Data &amp; Analytics" class="dd-item
        
        
        
        ">
      <a href="../../bigdata/">
          7. Big Data &amp; Analytics
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/bigdata/basics/" title="1. Big Data Basics" class="dd-item ">
        <a href="../../bigdata/basics/">
        1. Big Data Basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata/datawarehousing/" title="2. Data Warehousing &amp; BI" class="dd-item ">
        <a href="../../bigdata/datawarehousing/">
        2. Data Warehousing &amp; BI
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/extra/" title="X. Extras" class="dd-item
        
        
        
        ">
      <a href="../../extra/">
          X. Extras
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/extra/software/" title="Gebruikte Software" class="dd-item ">
        <a href="../../extra/software/">
        Gebruikte Software
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/extra/project/" title="Project 2023-2024" class="dd-item ">
        <a href="../../extra/project/">
        Project 2023-2024
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2022&amp;i=4290&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://toledo.kuleuven.be/portal/"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/kuleuven-diepenbeek/db-course/"><i class='fab fa-github'></i> Course Git Repository</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Index</a> > <a href='../../nosql/'>5. NoSQL</a> > 4. Advanced map-red. queries
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
        <li><a href="#oefeningen">Oefeningen</a></li>
        <li><a href="#denkvragen">Denkvragen</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              4. Advanced map-red. queries
            </h1>
          

        


<p>Deze oefeningen gaan verder op de database die je hebt opgezet in het stuk over <a href="../../nosql/documentstores">document stores</a>. Herinstalleer indien nodig en download de benodigde gegevens via de instructies (2.2 Oefeningen: <strong>voorbereidingswerk</strong>) in die link. Start voor onderstaande oefeningen de lokale <em>CouchDB Server</em> en de <em>Admin Console</em> (Project Fauxton) opnieuw op.</p>
<p>Zoals ook op de <a href="https://pouchdb.com/guides/queries.html">PouchDB docs</a> vermeld staat; zijn <strong>mapreduce</strong> queries niet altijd nodig:</p>
<ul>
<li>Documenten op <code>_id</code> raadplegen gaat door middel van de Curl REST API</li>
<li>Documenten sorteren of simpele queries uitvoeren gaat door middel van de Mango API, zoals reeds gezien. Dit zijn simpele queries, maar die volstaan meestal.</li>
<li>Indien de DB store &lt; <code>100.000</code> records bevat, zoals de onze, kan je ook simpelweg alles <strong>in-memory</strong> inladen (bijvoorbeeld in de browser), en met javascript zelf verder filteren:</li>
</ul>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">const</span> <span style="color:#75af00">db</span> <span style="color:#f92672">=</span> <span style="color:#75af00">pouchdb</span><span style="color:#111">.</span><span style="color:#75af00">get</span><span style="color:#111">();</span> <span style="color:#75715e">// zoiets
</span><span style="color:#75715e">// ...
</span><span style="color:#75715e"></span><span style="color:#00a8c8">const</span> <span style="color:#75af00">skillsOfBigCourses</span> <span style="color:#f92672">=</span> <span style="color:#75af00">db</span><span style="color:#111">.</span><span style="color:#75af00">filter</span><span style="color:#111">(</span><span style="color:#75af00">doc</span> <span style="color:#111">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">ECTS</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">6</span>
<span style="color:#111">}).</span><span style="color:#75af00">map</span><span style="color:#111">(</span><span style="color:#75af00">doc</span> <span style="color:#111">=&gt;</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#75af00">skills</span>
<span style="color:#111">})</span>
<span style="color:#75715e">// gebruik dit in een template HTML factory
</span></code></pre></div><h4 id="emit">Emit</h4>
<p>Een mapreduce query is in PouchDB uitvoerbaar met <code>db.query()</code> en in CouchDB deel van de <code>_view</code> API. Klik dus op het plusje <code>+</code> bij All Documents en dan op &ldquo;new view&rdquo;:</p>
<p><figure>
	<a href="../../img/couchview.jpg" data-featherlight="image">
		<img src="../../img/couchview.jpg"  >
	</a>
	
</figure>
</p>
<p>Daar kan je een nieuwe &ldquo;map&rdquo; functie aanmaken:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">function</span> <span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">)</span> <span style="color:#111">{</span>
  <span style="color:#75af00">emit</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">_id</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
</code></pre></div><p>Merk op dat hier de <strong>JavaScript</strong> syntax geldt. <code>emit()</code> betekent &ldquo;geef als key deze waarde terug voor elk gevonden document&rdquo;. Als je dit verandert naar <code>doc.title</code> wordt er een view aangemaakt die documenten op titel bewaart, om daar zeer snel in te kunnen zoeken. Bovenstaande functie wordt uitgevoerd <strong>voor elk document</strong>, vandaar de &ldquo;map&rdquo; in de naam. Het zou kunnen dat je filtert, vandaar de &ldquo;reduce&rdquo; in de naam.</p>
<p>Ik kan dus gewoon <code>if()</code> gebruiken, en zo documenten filteren. Alle cursussen gegeven in het tweede jaar of later:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">function</span> <span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">if</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">year</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">emit</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">title</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></div><h4 id="aggregeren">Aggregeren</h4>
<p>Stel dat ik de totale <code>ECTS</code> punten wil verzamelen van alle Belgische vakken in de database. Dus: eerst filteren op <code>country</code> property, en daarna de som nemen van alle <code>ECTS</code> properties. Hoe doe je zoiets in SQL? Met <code>SUM()</code> en <code>GROUP BY</code>:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a8c8">SELECT</span> <span style="color:#00a8c8">SUM</span><span style="color:#111">(</span><span style="color:#111">ECTS</span><span style="color:#111">)</span> <span style="color:#00a8c8">FROM</span> <span style="color:#111">courses</span>
<span style="color:#00a8c8">WHERE</span> <span style="color:#111">country</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Belgium&#34;</span>
<span style="color:#00a8c8">GROUP</span> <span style="color:#00a8c8">BY</span> <span style="color:#111">country</span>
</code></pre></div><p>Hoe doe je zoiets in NoSQL/Mongo/CouchDB? Met <a href="http://127.0.0.1:5984/_utils/docs/ddocs/ddocs.html#reduce-and-rereduce-functions">Reduce Functions</a>. Je kan in Fauxton bij het bewerken van je view een <strong>CUSTOM</strong> waarde in de Reduce combobox selecteren:</p>
<p><figure>
	<a href="../../img/couchreduce.jpg" data-featherlight="image">
		<img src="../../img/couchreduce.jpg"  >
	</a>
	
</figure>
</p>
<p>Wat is die derde <code>rereduce</code> parameter? Volgens de docs:</p>
<blockquote>
<p>Reduce functions take two required arguments of keys and values lists - the result of the related map function - and an optional third value which indicates if rereduce mode is active or not. Rereduce is used for additional reduce values list, so when it is true there is no information about related keys (first argument is null).</p>
</blockquote>
<p>Rereducen wordt typisch uitgevoerd bij een cluster met verschillende CouchDB Nodes die de data verdeelt. CouchDB ontvangt <em>groepen van inputs</em> in plaats van alles in één vanwege performantie optimalisatie. Dit systeem is <a href="https://blog.pablobm.com/2019/07/18/map-reduce-with-couchdb-a-visual-primer.html">visueel uitgelegd in deze primer</a>, maar is voor ons niet van toepassing.</p>
<p>Dus, map functie om te filteren op België:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">function</span> <span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">if</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">country</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;Belgium&#34;</span><span style="color:#111">)</span> <span style="color:#111">{</span>
      <span style="color:#75af00">emit</span><span style="color:#111">(</span><span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">_id</span><span style="color:#111">,</span> <span style="color:#75af00">doc</span><span style="color:#111">.</span><span style="color:#75af00">ECTS</span><span style="color:#111">);</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></div><p>Door <code>ECTS</code> in <code>emit()</code> mee te geven (als VALUE!) kunnen we in de <code>reduce</code> functie de array <code>values</code> manipuleren. En de reduce functie om de ECTS punten op te tellen:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">function</span> <span style="color:#111">(</span><span style="color:#75af00">keys</span><span style="color:#111">,</span> <span style="color:#75af00">values</span><span style="color:#111">,</span> <span style="color:#75af00">rereduce</span><span style="color:#111">)</span> <span style="color:#111">{</span> 
  <span style="color:#00a8c8">return</span> <span style="color:#75af00">sum</span><span style="color:#111">(</span><span style="color:#75af00">values</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
</code></pre></div><p><code>sum()</code> is een ingebouwde CouchDB functie. Dit kan ook manueel op de functionele JS <code>reduce()</code> manier:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a8c8">function</span> <span style="color:#111">(</span><span style="color:#75af00">keys</span><span style="color:#111">,</span> <span style="color:#75af00">values</span><span style="color:#111">,</span> <span style="color:#75af00">rereduce</span><span style="color:#111">)</span> <span style="color:#111">{</span> 
  <span style="color:#00a8c8">return</span> <span style="color:#75af00">values</span><span style="color:#111">.</span><span style="color:#75af00">reduce</span><span style="color:#111">((</span><span style="color:#75af00">a</span><span style="color:#111">,</span> <span style="color:#75af00">b</span><span style="color:#111">)</span> <span style="color:#111">=&gt;</span> <span style="color:#75af00">a</span> <span style="color:#f92672">+</span> <span style="color:#75af00">b</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
</code></pre></div><p>Klik op &ldquo;Run Query&rdquo;. De resultaten zijn de resultaten van de MAP - de Reduce value moet je expliciet enablen door vanboven rechts op &ldquo;Options&rdquo; te klikken, en dan &ldquo;Reduce&rdquo; aan te vinken:</p>
<p><figure>
	<a href="../../img/queryreduce.jpg" data-featherlight="image">
		<img src="../../img/queryreduce.jpg"  >
	</a>
	
</figure>
</p>
<p>Merk op dat je met &ldquo;Group Level&rdquo; moet spelen (Op <code>None</code> zetten) om de groepering te doen werken, anders gaat de reduce functie de som nemen op elk indiviudeel document, wat uiteraard geen correct som is.</p>
<p>Merk op dat reduce functies <em>verschillende keren kunnen worden opgeroepen</em> - en dat reduce reeds kan beginnen voordat map klaar is met zijn werk. Deze maatregelen zijn genomen om vlot om te kunnen gaan met miljarden records, verticaal verspreid over verschillende clusters.</p>
<h3 id="oefeningen">Oefeningen</h3>
<ol>
<li>Maak een nieuwe view die documenten teruggeeft die in de titel het woord &ldquo;project&rdquo; bevatten. Werk case-<em>insensistive</em>. Vergeet niet dat het zou kunnen dat sommige documenten géén <code>title</code> property hebben, of deze <code>null</code> is. Wat dan?</li>
<li>Schrijf een reduce query die voor alle bovenstaande titels het aantal cursussen weergeeft (enkel het aantal is voldoende) dat <code>explicit</code> op <code>true</code> heeft staan.</li>
<li>Schrijf een view die de som neemt van alle <code>ECTS</code> punten van alle cursussen. Doe dit op drie manieren:
<ul>
<li>Met de ingebouwde <code>_sum</code> functie.</li>
<li>Met een custom reduce en <code>sum()</code> zoals hierboven in het voorbeeld</li>
<li>Met een custom reduce die <code>values.reduce()</code> gebruikt: zie docs <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">Array.prototype.reduce()</a>.</li>
<li>Wat is volgens jou het fundamentele verschil tussen deze 3 opties? Op welk gebied?</li>
</ul>
</li>
<li>Kopieer je LightCouch oefening van <a href="../../nosql/documentstores">Document stores</a> als een nieuw Java project. Programmeer nu in Java om de view die je hebt gemaakt in oefening 2 op te roepen met <code>dbClient.view()</code>. Zie <a href="http://www.lightcouch.org/getstarted.html">LightCouch docs</a>.</li>
<li>Schrijf een view die het aantal optionele cursussen weergeeft waarvan &ldquo;motivate others&rdquo; een skill is.</li>
</ol>
<h3 id="denkvragen">Denkvragen</h3>
<ol>
<li>Waarom is het niet mogelijk in NoSQL databases om een simpele query uit te voeren die bijvoorbeeld auteurs opvraagt ouder dan een bepaalde leeftijd, en dan alle titels per auteur teruggeeft? (Hint: p. 321)</li>
<li>Wat is het verschil tussen <code>emit(doc._id, 1)</code> en <code>emit(doc._id, doc.year)</code>?</li>
<li>Wat is het verschil tussen <code>map()</code>, <code>reduce()</code> en <code>filter()</code> in Javascript? Hint: Zie Mozilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">MDN Web Docs</a>.</li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../nosql/documentstores/" title="3. Document stores"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../nosql/replication/" title="5. Replication" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1697097250"></script>
    <script src="../../js/perfect-scrollbar.min.js?1697097250"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1697097250"></script>
    <script src="../../js/jquery.sticky.js?1697097250"></script>
    <script src="../../js/featherlight.min.js?1697097250"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1697097250"></script>
    <script src="../../js/learn.js?1697097250"></script>
    <script src="../../js/hugo-learn.js?1697097250"></script>
    <script src="../../js/mermaid.min.js?1697097250"></script>
    <script>
    window.MathJax = {
      chtml: {
        scale: 2,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

